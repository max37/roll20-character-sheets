<div class="3colrow">
	<div class="col">
		<label>Figur:</label><input type="text" name="attr_character_name" /> <br />
		<label>Typ:</label><input type="text" name="attr_Typ" /> <br />
		<label>Grad:</label><input type="number" name="attr_Grad" value="1" />
		<!-- 		<div class="toggle-container">
			<input type="hidden" class="toggle" name="attr_KannZaubern" /><span><b>Kann Zaubern</b></span>
			<button type="action" name="act_KannZaubern" class="toggle">
				<span class="checked"><b>✓</b></span>
			</button>
		</div> -->
		<label>Kann zaubern</label><input type="checkbox" class="checkbox" value="1" name="attr_KannZaubern" /><br />
	</div>
	<div class="col">
		<img
			src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Midgard%20German%20RPG/midgard_logo.png" /><br />
	</div>
	<div class="col">
		<label>ES:</label><input type="text" name="attr_Erfahrungsschatz" value="0" /><br />
		<label>EP:</label><input type="text" name="attr_EP" value="0" /> <br />
		<span><b>SG</b> .</span><input type="number" name="attr_SG" value="0" />
		<span><b>GG</b> </span><input type="number" name="attr_GG" value="0" />
		<span><b>GP</b> </span><input type="number" name="attr_GP" value="0" />
	</div>

</div>

<div>
	<button type="action" name="act_Datenblatt">Datenblatt</button>
	<button type="action" name="act_Fertigkeiten">Fertigkeiten</button>
	<button type="action" name="act_Sprachen">Sprachen</button>
	<button type="action" name="act_Zauber">Zauber</button>
	<button type="action" name="act_KampfK">Kampfblatt</button>
	<!-- <button type="action" name="act_KampfZ">Kampf - Zauberer</button> -->
	<button type="action" name="act_Ausrustung">Ausrüstung</button>
	<button type="action" name="act_Notizen">Notizen</button>
	<!-- <button type="action" name="act_NSC">NSC</button> -->
</div>

<input type='hidden' class='sheet-tabstoggle' name='attr_sheetTab' value='Datenblatt' />

<div class='sheet-Datenblatt'>
	<h2>Datenblatt</h2>

	<div class="3colrow">

		<div class="col">

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Stärke}} {{Der Wurf Ist um [[@{St} +@{ItemBStärke} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Stärke von [[@{St}+@{ItemBStärke}]]!}}'
				name="roll_PW_St"></button>
			<label>Stärke</label><input type="number" name="attr_St" value="1" /><span> Bonus </span><input
				type="number" name="attr_ItemBStärke" value="0" /><br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Geschicklichkeit}} {{Der Wurf Ist um [[@{Gs} + @{ItemBGeschick}- 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Geschicklichkeit von [[@{Gs}+@{ItemBGeschick}]]!}}'
				name="roll_PW_Gs"></button>
			<label>Geschick</label><input type="number" name="attr_Gs" value="1" /> <span> Bonus </span><input
				type="number" name="attr_ItemBGeschick" value="0" /><br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Gewandtheit}} {{Der Wurf Ist um [[@{Gw} + @{ItemBGewandheit} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Gewandtheit von [[@{Gw}+@{ItemBGewandheit}]]!}}'
				name="roll_PW_Gw"></button>
			<label>Gewandtheit</label><input type="number" name="attr_Gw" value="1" /> <span> Bonus </span><input
				type="number" name="attr_ItemBGewandheit" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Konstitution}} {{Der Wurf Ist um [[@{Ko} + @{ItemBKonstitution} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Konstitution von [[@{Ko}+@{ItemBKonstitution}]]!}}'
				name="roll_PW_Ko"></button>
			<label>Konstitution</label><input type="number" name="attr_Ko" value="1" /><span> Bonus </span><input
				type="number" name="attr_ItemBKonstitution" value="0" /> <br />

		</div>

		<div class="col">
			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Intelligenz}} {{Der Wurf Ist um [[@{In} + @{ItemBIntelligenz}- 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Intelligenz von [[@{In}+@{ItemBIntelligenz}]]!}}'
				name="roll_PW_In"></button>
			<label>Intelligenz</label><input type="number" name="attr_In" value="1" /><span> Bonus </span><input
				type="number" name="attr_ItemBIntelligenz" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Zaubertalent}} {{Der Wurf Ist um [[@{Zt} + @{ItemBZaubertalent} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Zaubertalent von [[@{Zt}+@{ItemBZaubertalent}]]!}}'
				name="roll_PW_Zt"></button>
			<label>Zaubertalent</label><input type="number" name="attr_Zt" value="1" /> <span> Bonus </span><input
				type="number" name="attr_ItemBZaubertalent" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Aussehen}} {{Der Wurf Ist um [[@{Au} + @{ItemBAussehen} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Aussehen von [[@{Au}!+@{ItemBAussehen}]]}}'
				name="roll_PW_Au"></button>
			<label>Aussehen</label><input type="number" name="attr_Au" value="1" /> <span> Bonus </span><input
				type="number" name="attr_ItemBAussehen" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf persönliche Ausstrahlung}} {{Der Wurf Ist um [[@{pA} + @{ItemBpA} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für persönliche Ausstrahlung von [[@{pA}+@{ItemBpA}]]!}}'
				name="roll_PW_pA"></button>
			<label>pers.Ausstrahl.</label><input type="number" name="attr_pA" value="1" /> <span> Bonus </span><input
				type="number" name="attr_ItemBpA" value="0" /> <br />

		</div>

		<div class="col">
			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Willenskraft}} {{Der Wurf Ist um [[@{Wk} + @{ItemBWillenskraft}- 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Willenskraft von [[@{Wk}+@{ItemBWillenskraft}]]!}}'
				name="roll_PW_Wk"></button>
			<label>Willenskraft</label><input type="number" name="attr_Wk" value="1" /><span> Bonus </span><input
				type="number" name="attr_ItemBWillenskraft" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Gifttoleranz}} {{Der Wurf Ist um [[@{GiT} + @{ItemBGifttoleranz} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Gifttoleranz von [[@{GiT}+@{ItemBGifttoleranz}]]!}}'
				name="roll_PW_GiT"></button>
			<label>Gifttoleranz</label><input type="number" name="attr_GiT" value="30+floor(@{Ko}/2)" disabled="true" />
			<span> Bonus </span><input type="number" name="attr_ItemBGifttoleranz" value="0" /> <br />

		</div>
	</div>
	<hr />

	<div class="3colrow">
		<div class="col">
			<label>Abwehr</label><input type="number" name="attr_Abwehr" value="0" readonly /> <span> Bonus
			</span><input type="number" name="attr_ItemBAbwehr" value="0" /><br />
			<label>Zaubern</label><input type="number" name="attr_Zaubern" value="0" readonly /> <span> Bonus
			</span><input type="number" name="attr_ItemBZaubern" value="0" /><br />
			<label>Res.Geist</label><input type="number" name="attr_ResGeist" value="0" readonly /><span> Bonus
			</span><input type="number" name="attr_ItemBResG" value="0" /> <br />
			<label>Res.Körper</label><input type="number" name="attr_ResKörper" value="0" readonly /><span> Bonus
			</span><input type="number" name="attr_ItemBResK" value="0" /> <br />
			<label>Bewegungsw.</label><input type="number" name="attr_B" value="0" /><span> Bonus </span><input
				type="number" name="attr_ItemBB" value="0" /> <br />
			<label>LP Max</label><input type="number" name="attr_LP_max" value="0" /> <br />
			<label>AP Max</label><input type="number" name="attr_AP_max" value="0" /> <br />
			<h4>Persönlicher Bonus für</h4>
			<label>Ausdauer</label><input type="number" name="attr_BonusAP" value="0" readonly /><br />
			<label>Schaden</label><input type="number" name="attr_BonusSchaden" value="0" readonly /><br />
			<label>Angriff</label><input type="number" name="attr_BonusAngriff" value="0" readonly /><br />
			<label>Abwehr</label><input type="number" name="attr_BonusAbwehr" value="0" readonly /><br />
			<label>Zauber</label><input type="number" name="attr_BonusZauber" value="0" readonly /><br />
			<label>Res.Geist</label><input type="number" name="attr_BonusResG" value="0" readonly /><span> Bonus
				Rasse/Klasse </span><input type="number" name="attr_RaKlBonusResG" value="0" /><br />
			<label>Res.Körper</label><input type="number" name="attr_BonusResK" value="0" readonly /><span> Bonus
				Rasse/Klasse </span><input type="number" name="attr_RaKlBonusResK" value="0" /><br />

		</div>
		<div class="col">
			<label>Geschlecht</label><input type="text" name="attr_Geschlecht" /> <br />
			<label>Rasse</label><input type="text" name="attr_Rasse" /> <br />
			<label>Heimat</label><input type="text" name="attr_Heimat" /> <br />
			<label>Stand</label><input type="text" name="attr_Stand" /> <br />
			<label>Gestalt</label><input type="text" name="attr_Gestalt" /> <br />
			<label>Augen</label><input type="text" name="attr_Augen" /> <br />
			<label>Haare</label><input type="text" name="attr_Haare" /> <br />
			<label>Glaube</label><input type="text" name="attr_Glaube" /> <br />
			<br /><br /><br />
			<h4>Bonus Leiteigenschaften</h4>
			<label>Stärke</label><input type="number" name="attr_LeitSt" value="0" readonly /><br />
			<label>Geschick</label><input type="number" name="attr_LeitGs" value="0" readonly /><br />
			<label>Gewandtheit</label><input type="number" name="attr_LeitGw" value="0" readonly /><br />
			<label>Konstitution</label><input type="number" name="attr_LeitKo" value="0" readonly /><br />
			<label>Intelligenz</label><input type="number" name="attr_LeitIn" value="0" readonly /><br />
			<label>Zaubertalent</label><input type="number" name="attr_LeitZt" value="0" readonly /><br />
			<label>Aussehen</label><input type="number" name="attr_LeitAu" value="0" readonly /><br />
			<label>pers.Ausstrahl.</label><input type="number" name="attr_LeitpA" value="0" readonly /><br />
			<label>Willenskraft</label><input type="number" name="attr_LeitWk" value="0" readonly /><br />
		</div>
		<div class="col">

			<button type='roll'
				value='&{template:default} {{name=@{character_name} versucht Glück zu haben}} {{Glückswurf=[[1d100 + @{ItemBGlückswurf} - 1d100 -  ?{Bonus|0}]]}}'
				name="roll_PW_Gl"></button>
			<label>Glückswurf</label> <span> Bonus </span><input type="number" name="attr_ItemBGlückswurf"
				value="0" /><br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Geistesblitz}} {{Der Wurf Ist um [[@{GBlitz} + @{ItemBGeistesblitz} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Geistesblitz von [[@{GBlitz}+@{ItemBGeistesblitz}]]!}}'
				name="roll_PW_GBlitz"></button>
			<label>Geistesblitz</label><input type="number" name="attr_GBlitz"
				value="floor((@{In}+@{itemBIntelligenz})/10)" disabled="true" /> <span> Bonus </span><input
				type="number" name="attr_ItemBGeistesblitz" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt aufn Kraftakt}}  {{Der Wurf Ist um [[@{KraftaktW} + @{ItemBKraftakt} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Kraftaktwert von [[@{KraftaktW}+@{ItemBKraftakt}]]!}}'
				name="roll_PW_KAW"></button>
			<label>Kraftakt</label><input type="number" name="attr_KraftaktW" value="floor((@{St}+@{ItemBStärke})/10)"
				disabled="true" /> <span> Bonus </span><input type="number" name="attr_ItemBKraftakt" value="0" />
			<br />
			<hr />

			<h4>Merkmale</h4> <br />
			<textarea name="attr_Merkmale"></textarea> <br />

		</div>
	</div>

</div>

<div class='sheet-Fertigkeiten'>
	<h2>Fertigkeiten</h2>
	<div class="2colrow">
		<div class="col">
			<span class="span-header center" style="margin-left: 35px"><b>R</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>Fertigkeit</b></span>
			<span class="span-header center" style="margin-left: 105px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 90px"><b>Bonus</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>PP</b></span>
			<span class="span-header center" style="margin-left: 27px"><b>KBlatt</b></span>
			<fieldset class="repeating_fertigkeiten">
				<button type='roll' name="roll_ew_fertigkeit"
					value='&{template:default} {{name=@{character_name} würfelt auf @{Fertigkeit}}} {{EW:@{Fertigkeit}=[[1d20cs16cs17cs18cs19cs20cf1cf16cf17cf18cf19 + @{FW} + @{leitE} + @{Fertigkeitsbonus} + ?{Bonus|0}]]}}'></button>
				<input type='checkbox' class="checkbox" name='attr_toggle-section' value="1">
				<!-- it doesnt need to be a checkbox -->
				<input class='sheet-section-toggle' type='hidden' name='attr_toggle-section'>
				<input type="text" name="attr_Fertigkeit" value="Name" />
				<input type="number" name="attr_FW" value="0" />
				<select name="attr_LeitE" class="dtype">
					<option value="0" selected="selected">-</option>
					<option value="@{LeitSt}">St</option>
					<option value="@{LeitGs}">Gs</option>
					<option value="@{LeitGw}">Gw</option>
					<option value="@{LeitKo}">Ko</option>
					<option value="@{LeitIn}">In</option>
					<option value="@{LeitZt}">Zt</option>
					<option value="@{LeitAu}">Au</option>
					<option value="@{LeitpA}">pA</option>
					<option value="@{LeitWk}">Wk</option>
				</select>
				<input type="number" name="attr_Fertigkeitsbonus" value="0" />
				<input type="number" name="attr_FertPP" value="0" />
				<input type="checkbox" class="checkbox" style="margin-left: 12px" value="1" name="attr_FertKB" />
				<div class="sheet-section-hide">
					<textarea name="attr_FertBeschreibung"></textarea>
				</div>
			</fieldset>
			<button type="action" name="act_fertkb" >Fertigkeiten auf dem Kampfblatt neu setzen.</button>
		</div>
		<div class="col">
			<span class="span-header center" style="margin-left: 35px"><b>Sinne / Ungelernt</b></span>
			<span class="span-header center" style="margin-left: 57px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 90px"><b>Bonus</b></span>
			<!--			<span class="span-header center" style="margin-left: 5px"><b>K</b></span>				-->
			<span class="span-header center" style="margin-left: 5px"><b>PP</b></span>
			<fieldset class="repeating_fertigkeiten2">
				<button type='roll'
					value='&{template:default} {{name=@{character_name} würfelt auf @{Fertigkeit2}}} {{EW:@{Fertigkeit2}=[[1d20cs16cs17cs18cs19cs20cf1cf16cf17cf18cf19 + @{FW2} + @{leitE2} + @{Fertigkeitsbonus2} + ?{Bonus|0}]]}}'
					name="roll_EW_Fertigkeit"></button>
				<input type="text" name="attr_Fertigkeit2" value="Name" />
				<input type="number" name="attr_FW2" value="0" />
				<select name="attr_LeitE2" class="dtype">
					<option value="0" selected="selected">-</option>
					<option value="@{LeitSt}">St</option>
					<option value="@{LeitGs}">Gs</option>
					<option value="@{LeitGw}">Gw</option>
					<option value="@{LeitKo}">Ko</option>
					<option value="@{LeitIn}">In</option>
					<option value="@{LeitZt}">Zt</option>
					<option value="@{LeitAu}">Au</option>
					<option value="@{LeitpA}">pA</option>
					<option value="@{LeitWk}">Wk</option>
				</select>
				<input type="number" name="attr_Fertigkeitsbonus2" value="0" />
				<input type="number" name="attr_FertPP2" value="0" />
			</fieldset>
			<button type="action" name="act_addsinnung">Sinne und ungelernte Fertigkeiten hinzufügen</button>
			<br />
		</div>

	</div>
</div>

<div class='sheet-Sprachen'>
	<h2>Sprachen</h2>
	<div class="2colrow">
		<div class="col">
			<h3>Lesen/Schreiben</h3><br />
			<span class="span-header center" style="margin-left: 35px"><b>Fertigkeit</b></span>
			<span class="span-header center" style="margin-left: 105px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 90px"><b>Bonus</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>PP</b></span>
			<fieldset class="repeating_sprache">
				<button type='roll' name="roll_ew_lesen"
					value='&{template:default} {{name=@{character_name} liest/schreibt @{lesen}}} {{EW:@{lesen}=[[1d20cs16cs17cs18cs19cs20cf1cf16cf17cf18cf19 + @{FW_lesen} + @{lesen_leitE} + @{lesen_Fertigkeitsbonus} + ?{Bonus|0}]]}}'></button>
				<input type="text" name="attr_lesen" value="Name" />
				<input type="number" name="attr_FW_lesen" value="0" />
				<select name="attr_lesen_LeitE" class="dtype">
					<option value="0">-</option>
					<option value="@{LeitSt}">St</option>
					<option value="@{LeitGs}">Gs</option>
					<option value="@{LeitGw}">Gw</option>
					<option value="@{LeitKo}">Ko</option>
					<option value="@{LeitIn}" selected="selected">In</option>
					<option value="@{LeitZt}">Zt</option>
					<option value="@{LeitAu}">Au</option>
					<option value="@{LeitpA}">pA</option>
					<option value="@{LeitWk}">Wk</option>
				</select>
				<input type="number" name="attr_lesen_Fertigkeitsbonus" value="0" />
				<input type="number" name="attr_lesen_FertPP" value="0" />
			</fieldset>
		</div>

		<div class="col">
			<h3>Sprechen</h3><br />
			<span class="span-header center" style="margin-left: 35px"><b>Fertigkeit</b></span>
			<span class="span-header center" style="margin-left: 105px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 90px"><b>Bonus</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>PP</b></span>
			<fieldset class="repeating_sprechen">
				<button type='roll' name="roll_ew_sprechen"
					value='&{template:default} {{name=@{character_name} spricht @{sprache}}} {{EW:@{sprache}=[[1d20cs16cs17cs18cs19cs20cf1cf16cf17cf18cf19 + @{FW_sprechen} + @{sprechen_leitE} + @{sprechen_Fertigkeitsbonus} + ?{Bonus|0}]]}}'></button>
				<input type="text" name="attr_sprache" value="Name" />
				<input type="number" name="attr_FW_sprechen" value="0" />
				<select name="attr_sprechen_LeitE" class="dtype">
					<option value="0">-</option>
					<option value="@{LeitSt}">St</option>
					<option value="@{LeitGs}">Gs</option>
					<option value="@{LeitGw}">Gw</option>
					<option value="@{LeitKo}">Ko</option>
					<option value="@{LeitIn}" selected="selected">In</option>
					<option value="@{LeitZt}">Zt</option>
					<option value="@{LeitAu}">Au</option>
					<option value="@{LeitpA}">pA</option>
					<option value="@{LeitWk}">Wk</option>
				</select>
				<input type="number" name="attr_sprechen_Fertigkeitsbonus" value="0" />
				<input type="number" name="attr_sprechen_FertPP" value="0" />
			</fieldset>
		</div>

	</div>
</div>

<div class='sheet-Zauber'>
	<h2>Zauber</h2>
	<span class="span-header center" style="margin-left: 35px"><b>R</b></span>
	<span class="span-header center" style="margin-left: 5px"><b>Zauber</b></span>
	<span class="span-header center" style="margin-left: 120px"><b>Bonus</b></span>
	<span class="span-header center" style="margin-left: 5px"><b>AP</b></span>
	<span class="span-header center" style="margin-left: 85px"><b>Zauberdauer</b></span>
	<span class="span-header center" style="margin-left: 20px"><b>Wirk.Bereich</b></span>
	<span class="span-header center" style="margin-left: 20px"><b>Reichweite</b></span>
	<span class="span-header center" style="margin-left: 30px"><b>Wirkungsdauer</b></span>
	<span class="span-header center" style="margin-left: 10px"><b>Ziel</b></span>
	<span class="span-header center" style="margin-left: 75px"><b>Art</b></span>
	<span class="span-header center" style="margin-left: 80px"><b>Prozess</b></span>
	<span class="span-header center" style="margin-left: 80px"><b>PP</b></span>
	<span class="span-header center" style="margin-left: 25px"><b>KBlatt</b></span>
	<fieldset class="repeating_zauber">
		<button type='roll'
			value='&{template:default} {{name=@{character_name} zaubert @{Zauber}}} {{EW:Zaubern=[[1D20 + @{Zaubern} + @{ZauSpezBonus} + @{BonusZauber} + @{itemBZaubern} + @{modZaubern} + ?{Bonus|0} ]]}} {{AP=@{AP}}} {{Zauberdauer=@{Zd}}} {{Wirkungsbereich=@{Wb}}} {{Reichweite=@{Rw}}} {{Wirkungsdauer=@{Wd}}} {{Ziel=@{ziel}}} {{Art=@{art}}}'
			name="roll_EW_Zaubern"></button>
		<input type='checkbox' class="checkbox" name='attr_toggle-section' value="1">
		<!-- it doesnt need to be a checkbox -->
		<input class='sheet-section-toggle' type='hidden' name='attr_toggle-section'>
		<input type="text" name="attr_Zauber" value="Name" />
		<input type="number" name="attr_ZauSpezBonus" value="0" />
		<input type="text" name="attr_AP" style="width:100px" value="AP" />
		<input type="text" name="attr_ZD" style="width:100px" value="Zd" />
		<input type="text" name="attr_WB" style="width:100px" value="Wb" />
		<input type="text" name="attr_RW" style="width:100px" value="Rw" />
		<input type="text" name="attr_WD" style="width:100px" value="Wd" />
		<select name="attr_Ziel" class="ziel">
			<option value="Ziel" selected="selected">Ziel</option>
			<option value="Umgebung">Umgebung</option>
			<option value="Geist">Geist</option>
			<option value="Körper">Körper</option>
		</select>
		<select name="attr_Art" class="art">
			<option value="Art" selected="selected">Art</option>
			<option value="Gedanke">Gedanke</option>
			<option value="Geste">Geste</option>
			<option value="Wort">Wort</option>
		</select>
		<select name="attr_Prozess" class="prozess">
			<option value="Prozess" selected="selected">Prozess</option>
			<option value="Ohne">Ohne</option>
			<option value="Beherrschen">Beherrschen</option>
			<option value="Bewegen">Bewegen</option>
			<option value="Erkennen">Erkennen</option>
			<option value="Erschaffen">Erschaffen</option>
			<option value="Formen">Formen</option>
			<option value="Verändern">Verändern</option>
			<option value="Zerstören">Zerstören</option>
			<option value="Wundertat">Wundertat</option>
			<option value="Dweomer">Dweomer</option>
			<option value="Zauberlied">Zauberlied</option>
			<option value="Salz">Salz</option>
			<option value="Thaumagraphie">Thaumagraphie</option>
			<option value="Beschwören">Beschwören</option>
			<option value="Nekromantie">Nekromantie</option>
			<option value="Thaumatherapie">Thaumatherapie</option>
			<option value="Zaubermittel">Zaubermittel</option>
			<option value="Zauberschutz">Zauberschutz</option>
		</select>
		<input type="number" name="attr_ZauPP" value="0" />
		<input type="checkbox" class="checkbox" value="1" name="attr_ZauKB" style="margin-left: 10px" />
		<div class="sheet-section-hide">
			<textarea name="attr_ZauWirkung"></textarea>
		</div>
	</fieldset>
	<button type="action" name="act_zaukb" >Zauber auf dem Kampfblatt neu setzen.</button>
</div>

<div class='sheet-KampfK'>

	<h2>Kampfblatt</h2>

	<div class="2colrow">
		<div class="col">

			<button type='roll'
				value='&{template:default} {{name=@{character_name}}} {{EW:Raufen=[[1d20 + @{Raufen} + @{ItemBRaufen} + ?{Bonus|0}]]}} {{Schaden=[[1d6 + @{BonusSchaden} + @{ItemBRaufenSch} +@{modSchaden}]]}}'
				name="roll_EW_Raufen"></button>
			<span><b>Raufen</b> </span><input type="number" name="attr_Raufen"
				value="floor((@{St}+@{ItemBStärke}+@{Gw}+@{ItemBGewandheit})/20)+@{BonusAngriff} + @{gRüsAnB}"
				disabled="true" />
			<span> Bonus </span><input type="number" name="attr_ItemBRaufen" value="0" />
			<span> Sch.B </span><input type="number" name="attr_ItemBRaufenSch" value="0" />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} resistiert}} {{WW:Geist=[[1D20 + @{KampfResG} + ?{Bonus|0}]]}}'
				name="roll_WW_Geist"></button>
			<span><b>ResG</b> </span> <input type="number" name="attr_KampfResG"
				value="@{ResGeist} + @{ItemBResG} + @{BonusResG} + @{modResG}" disabled="true" />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} resistiert}} {{WW:Körper=[[1D20 + @{KampfResK} + ?{Bonus|0}]]}}'
				name="roll_WW_Koerper"></button>
			<span><b>ResK</b> </span> <input type="number" name="attr_KampfResK"
				value="@{ResKörper} + @{ItemBResK} + @{BonusResK} + @{modResK}" disabled="true" />

			<br />
			<button type='roll'
				value='&{template:default} {{name=@{character_name}}} {{Handlungsrang=[[@{aktGw} &{tracker}]]}}'
				name="roll_Handlungsrang"></button>
			<span><b>Handlungsrang</b></span><input type="number" name="attr_aktGw" style="width:60px"
				value="@{GW} + @{ItemBGewandheit} + @{ModGw} + @{gRusGW}" disabled="true" />
			<span><b>LP </b></span><input type="number" name="attr_LP" value="0" /> <span> / </span> <input
				type="number" name="attr_LP_max" value="0" readonly />
			<span><b>AP </b></span><input type="number" name="attr_AP" value="0" /> <span> / </span> <input
				type="number" name="attr_AP_max" value="0" readonly />
			<span><b>B </b></span> <input type="number" name="attr_aktB" value="@{B} + @{ItemBB} + @{ModB} + @{gRüsB}"
				disabled="true" />

			<br /><br />
			<h3>Angriff</h3> <br />

			<span class="span-header center" style="margin-left: 32px"><b>Fk</b></span>
			<span class="span-header center" style="margin-left: 2px"><b>Waffe</b></span>
			<span class="span-header center" style="margin-left: 130px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 18px"><b>Spz.</b></span>
			<span class="span-header center" style="margin-left: 0px"><b>Schaden</b></span>
			<span class="span-header center" style="margin-left: 10px"><b>AnB</b></span>
			<span class="span-header center" style="margin-left: 1px"><b>Sc.B</b></span>
			<span class="span-header center" style="margin-left: 3px"><b>Rng</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>EW</b></span>
			<span class="span-header center" style="margin-left: 7px"><b>SB</b></span>
			<span class="span-header center" style="margin-left: 15px"><b>PP</b></span>

			<fieldset class="repeating_angriff">
				<button type='roll'
					value='&{template:default} {{name=@{character_name} greift an}} {{EW:@{Waffe}=[[1d20 + @{WaffeEW} + ?{Bonus|0}]]}} {{Schaden=[[@{WaffeSchaden} + @{WaffeEfSchB}]]}}'
					name="roll_EW_Angriff"></button>
				<input type="checkbox" class="checkbox" name="attr_FKWaffe" value="1" />
				<input type="text" name="attr_Waffe" value="Name" />
				<input type="text" name="attr_FWWaffe" style="width:40px" value="0" />
				<input type="text" name="attr_SpezWaffe" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeSchaden" style="width:60px" value="1D6+?" />
				<input type="text" name="attr_WaffeAngB" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeSchB" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeRang" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeEW" style="width:30px" value="0" readonly />
				<input type="text" name="attr_WaffeEfSchB" style="width:30px" value="0" readonly />
				<input type="number" name="attr_WaffePP" style="width:40px" value="0" />
			</fieldset>

			<br />
			<h3>Rüstung</h3> <br />

			<span class="span-header center" style="margin-left: 30px"><b>Rüstung</b></span>
			<span class="span-header center" style="margin-left: 50px"><b>LP</b></span>
			<span class="span-header center" style="margin-left: 20px"><b>AP</b></span>
			<span class="span-header center" style="margin-left: 25px"><b>AnB</b></span>
			<span class="span-header center" style="margin-left: 15px"><b>AbB</b></span>
			<span class="span-header center" style="margin-left: 10px"><b>B</b></span>
			<span class="span-header center" style="margin-left: 40px"><b>Gw</b></span>

			<fieldset class="repeating_ruestung">
				<input type="checkbox" class="checkbox" value="1" name="attr_RsGetragen" style="margin-left: 10px"
					readonly />
				<input type="text" name="attr_Rüstung" style="width:100px" value="Name" />
				<input type="number" name="attr_RüsLP" style="width:40px" value="0" />
				<input type="number" name="attr_RüsAP" style="width:40px" value="0" />
				<input type="number" name="attr_RüsAnB" style="width:40px" value="0" />
				<input type="number" name="attr_RüsAbwB" style="width:40px" value="0" />
				<input type="number" name="attr_RüsB" style="width:50px" value="0" />
				<input type="number" name="attr_RüsGw" style="width:50px" value="0" />
				<button type='action' name='act_anlegen'>An&#47;Ablegen</button>
			</fieldset>

		</div>


		<div class="col">

			<span><b>Modifikationen:</b></span>
			<span><b>Rang</b></span><input type="number" name="attr_ModGw" style="width:60px" value="0" />
			<span><b>Angriff</b></span><input type="number" name="attr_modAngriff" value="0" />
			<span style="margin-left: 4px"><b>Abwehr</b></span><input type="number" name="attr_modAbwehr" value="0" />
			<span style="margin-left: 4px"><b>B </b></span><input type="number" name="attr_modB" value="0" />
			<br />
			<span><b>Schaden</b></span><input type="number" name="attr_modSchaden" value="0" />
			<span style="margin-left: 10px"><b>ResG</b></span><input type="number" name="attr_modResG" value="0" />
			<span style="margin-left: 10px"><b>ResK</b></span><input type="number" name="attr_modResK" value="0" />
			<span><b>Zaubern</b></span><input type="number" name="attr_modZaubern" value="0" />
			<br />

			<br />

			<h3>Abwehr</h3> <br />

			<span class="span-header center" style="margin-left: 35px"><b>Waffe</b></span>
			<span class="span-header center" style="margin-left: 130px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 15px"><b>AbwB</b></span>
			<span class="span-header center" style="margin-left: 10px"><b>AP</b></span>
			<span class="span-header center" style="margin-left: 17px"><b>WW</b></span>
			<span class="span-header center" style="margin-left: 20px"><b>PP</b></span>

			<fieldset class="repeating_abwehr">
				<button type='roll'
					value='&{template:default} {{name=@{character_name} wehrt ab}} {{WW:@{AbwWaffe}=[[1d20 + @{AbwWaffeWW} + ?{Bonus|0}]]}}'
					name="roll_WW_Abwehr"></button>
				<input type="text" name="attr_AbwWaffe" value="Name" />
				<input type="number" name="attr_FWAbwWaffe" style="width:40px" value="0" />
				<input type="number" name="attr_WaffeAbwB" style="width:40px" value="0" />
				<input type="number" name="attr_AbwWAP" style="width:40px" value="0" />
				<input type="number" name="attr_AbwWaffeWW" style="width:40px"
					value="@{Abwehr} + @{FWAbwWaffe} + @{WaffeAbwB} + @{BonusAbwehr} + @{ItemBAbwehr} + @{modAbwehr} + @{gRüsAbwB}"
					disabled="true" />
				<input type="number" name="attr_AbWWaffePP" style="width:40px" value="0" />
			</fieldset>

			<br />
			<h3>Fertigkeiten</h3> <br />

			<span class="span-header center" style="margin-left: 35px"><b>R</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>Fertigkeit</b></span>
			<span class="span-header center" style="margin-left: 105px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 90px"><b>Bonus</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>PP</b></span>
			<span class="span-header center" style="margin-left: 27px"><b>KBlatt</b></span>

			<fieldset class="repeating_fertigkeiten">
				<input type="hidden" class="repeating-show" name="attr_repeating_show" value="1">
				<div class="repeating-display">
					<button type='roll' name="roll_ew_fertigkeit"
						value='&{template:default} {{name=@{character_name} würfelt auf @{Fertigkeit}}} {{EW:@{Fertigkeit}=[[1d20cs16cs17cs18cs19cs20cf1cf16cf17cf18cf19 + @{FW} + @{leitE} + @{Fertigkeitsbonus} + ?{Bonus|0}]]}}'></button>
					<input type='checkbox' class="checkbox" name='attr_toggle-section' value="1">
					<!-- it doesnt need to be a checkbox -->
					<input class='sheet-section-toggle' type='hidden' name='attr_toggle-section'>
					<input type="text" name="attr_Fertigkeit" value="Name" />
					<input type="number" name="attr_FW" value="0" />
					<select name="attr_LeitE" class="dtype">
						<option value="0" selected="selected">-</option>
						<option value="@{LeitSt}">St</option>
						<option value="@{LeitGs}">Gs</option>
						<option value="@{LeitGw}">Gw</option>
						<option value="@{LeitKo}">Ko</option>
						<option value="@{LeitIn}">In</option>
						<option value="@{LeitZt}">Zt</option>
						<option value="@{LeitAu}">Au</option>
						<option value="@{LeitpA}">pA</option>
						<option value="@{LeitWk}">Wk</option>
					</select>
					<input type="number" name="attr_Fertigkeitsbonus" value="0" />
					<input type="number" name="attr_FertPP" value="0" />
					<input type="checkbox" class="checkbox" style="margin-left: 12px" value="1" name="attr_FertKB" />
					<div class="sheet-section-hide">
						<textarea name="attr_FertBeschreibung"></textarea>
					</div>
				</div>
			</fieldset>
		</div>

	</div>

	<br />
	<h3>Zauber</h3> <br />

	<span class="span-header center" style="margin-left: 35px"><b>R</b></span>
	<span class="span-header center" style="margin-left: 5px"><b>Zauber</b></span>
	<span class="span-header center" style="margin-left: 120px"><b>Bonus</b></span>
	<span class="span-header center" style="margin-left: 5px"><b>AP</b></span>
	<span class="span-header center" style="margin-left: 85px"><b>Zauberdauer</b></span>
	<span class="span-header center" style="margin-left: 20px"><b>Wirk.Bereich</b></span>
	<span class="span-header center" style="margin-left: 20px"><b>Reichweite</b></span>
	<span class="span-header center" style="margin-left: 30px"><b>Wirkungsdauer</b></span>
	<span class="span-header center" style="margin-left: 10px"><b>Ziel</b></span>
	<span class="span-header center" style="margin-left: 75px"><b>Art</b></span>
	<span class="span-header center" style="margin-left: 80px"><b>Prozess</b></span>
	<span class="span-header center" style="margin-left: 80px"><b>PP</b></span>
	<span class="span-header center" style="margin-left: 25px"><b>KBlatt</b></span>
	<fieldset class="repeating_zauber">
		<input type="hidden" class="repeating-show" name="attr_repeating_show" value="1">
		<div class="repeating-display">
			<button type='roll'
				value='&{template:default} {{name=@{character_name} zaubert @{Zauber}}} {{EW:Zaubern=[[1D20 + @{Zaubern} + @{ZauSpezBonus} + @{BonusZauber} + @{itemBZaubern} + @{modZaubern} + ?{Bonus|0} ]]}} {{AP=@{AP}}} {{Zauberdauer=@{Zd}}} {{Wirkungsbereich=@{Wb}}} {{Reichweite=@{Rw}}} {{Wirkungsdauer=@{Wd}}} {{Ziel=@{ziel}}} {{Art=@{art}}}'
				name="roll_EW_Zaubern"></button>
			<input type='checkbox' class="checkbox" name='attr_toggle-section' value="1">
			<!-- it doesnt need to be a checkbox -->
			<input class='sheet-section-toggle' type='hidden' name='attr_toggle-section'>
			<input type="text" name="attr_Zauber" value="Name" />
			<input type="number" name="attr_ZauSpezBonus" value="0" />
			<input type="text" name="attr_AP" style="width:100px" value="AP" />
			<input type="text" name="attr_ZD" style="width:100px" value="Zd" />
			<input type="text" name="attr_WB" style="width:100px" value="Wb" />
			<input type="text" name="attr_RW" style="width:100px" value="Rw" />
			<input type="text" name="attr_WD" style="width:100px" value="Wd" />
			<select name="attr_Ziel" class="ziel">
				<option value="Ziel" selected="selected">Ziel</option>
				<option value="Umgebung">Umgebung</option>
				<option value="Geist">Geist</option>
				<option value="Körper">Körper</option>
			</select>
			<select name="attr_Art" class="art">
				<option value="Art" selected="selected">Art</option>
				<option value="Gedanke">Gedanke</option>
				<option value="Geste">Geste</option>
				<option value="Wort">Wort</option>
			</select>
			<select name="attr_Prozess" class="prozess">
				<option value="Prozess" selected="selected">Prozess</option>
				<option value="Ohne">Ohne</option>
				<option value="Beherrschen">Beherrschen</option>
				<option value="Bewegen">Bewegen</option>
				<option value="Erkennen">Erkennen</option>
				<option value="Erschaffen">Erschaffen</option>
				<option value="Formen">Formen</option>
				<option value="Verändern">Verändern</option>
				<option value="Zerstören">Zerstören</option>
				<option value="Wundertat">Wundertat</option>
				<option value="Dweomer">Dweomer</option>
				<option value="Zauberlied">Zauberlied</option>
				<option value="Salz">Salz</option>
				<option value="Thaumagraphie">Thaumagraphie</option>
				<option value="Beschwören">Beschwören</option>
				<option value="Nekromantie">Nekromantie</option>
				<option value="Thaumatherapie">Thaumatherapie</option>
				<option value="Zaubermittel">Zaubermittel</option>
				<option value="Zauberschutz">Zauberschutz</option>
			</select>
			<input type="number" name="attr_ZauPP" value="0" />
			<input type="checkbox" class="checkbox" value="1" name="attr_ZauKB" style="margin-left: 10px" />
			<div class="sheet-section-hide">
				<textarea name="attr_ZauWirkung"></textarea>
			</div>
		</div>
	</fieldset>

</div>

<!-- <div class='sheet-KampfZ'>

	<h2>Kampfblatt - Zauberer</h2>

	<div class="2colrow">
		<div class="col">
			<button type='roll'
				value='&{template:default} {{name=@{character_name}}} {{EW:Raufen=[[1d20 + @{Raufen} + @{ItemBRaufen} + ?{Bonus|0}]]}} {{Schaden=[[1d6 + @{BonusSchaden} + @{ItemBRaufenSch} + @{modSchaden}]]}}'
				name="roll_EW_Raufen"></button>
			<span><b>Raufen</b> </span><input type="number" name="attr_Raufen"
				value="floor((@{St}+@{ItemBStärke}+@{Gw}+@{ItemBGewandheit})/20)+@{BonusAngriff} + @{gRüsAnB}"
				disabled="true" />
			<span> Bonus </span><input type="number" name="attr_ItemBRaufen" value="0" />
			<span> Sch.B </span><input type="number" name="attr_ItemBRaufenSch" value="0" />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} resistiert}} {{WW:Geist=[[1D20 + @{KampfResG} + ?{Bonus|0}]]}}'
				name="roll_WW_Geist"></button>
			<span><b>ResG</b> </span> <input type="number" name="attr_KampfResG"
				value="@{ResGeist} + @{ItemBResG} + @{BonusResG} + @{modResG}" disabled="true" />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} resistiert}} {{WW:Körper=[[1D20 + @{KampfResK} + ?{Bonus|0}]]}}'
				name="roll_WW_Koerper"></button>
			<span><b>ResK</b> </span> <input type="number" name="attr_KampfResK"
				value="@{ResKörper} + @{ItemBResK} + @{BonusResK} + @{modResK}" disabled="true" />

			<br />
			<button type='roll'
				value='&{template:default} {{name=@{character_name}}} {{Handlungsrang=[[@{aktGw} &{tracker}]]}}'
				name="roll_Handlungsrang"></button>
			<span><b>Handlungsrang</b></span><input type="number" name="attr_aktGw" style="width:60px"
				value="@{GW} + @{ItemBGewandheit} + @{ModGw} + @{gRusGW}" disabled="true" />
			<span><b>LP </b></span><input type="number" name="attr_LP" value="0" /> <span> / </span> <input
				type="number" name="attr_LP_max" value="0" readonly />
			<span><b>AP </b></span><input type="number" name="attr_AP" value="0" /> <span> / </span> <input
				type="number" name="attr_AP_max" value="0" readonly />
			<span><b>B </b></span> <input type="number" name="attr_aktB" value="@{B} + @{ItemBB} + @{ModB} +@{gRüsB}"
				disabled="true" />
		</div>
		<div class="col">
			<span><b>Modifikationen:</b></span>
			<span><b>Rang</b></span><input type="number" name="attr_ModGw" style="width:60px" value="0" />
			<span><b>Angriff</b></span><input type="number" name="attr_modAngriff" value="0" />
			<span style="margin-left: 4px"><b>Abwehr</b></span><input type="number" name="attr_modAbwehr" value="0" />
			<span style="margin-left: 4px"><b>B </b></span><input type="number" name="attr_modB" value="0" />
			<br />
			<span><b>Schaden</b></span><input type="number" name="attr_modSchaden" value="0" />
			<span style="margin-left: 10px"><b>ResG</b></span><input type="number" name="attr_modResG" value="0" />
			<span style="margin-left: 10px"><b>ResK</b></span><input type="number" name="attr_modResK" value="0" />
			<span><b>Zaubern</b></span><input type="number" name="attr_modZaubern" value="0" />
			<br />

		</div>
	</div>
	<br />

	<h3>Zauber</h3> <br />

	<span class="span-header center" style="margin-left: 35px"><b>R</b></span>
	<span class="span-header center" style="margin-left: 5px"><b>Zauber</b></span>
	<span class="span-header center" style="margin-left: 120px"><b>Bonus</b></span>
	<span class="span-header center" style="margin-left: 5px"><b>AP</b></span>
	<span class="span-header center" style="margin-left: 85px"><b>Zauberdauer</b></span>
	<span class="span-header center" style="margin-left: 20px"><b>Wirk.Bereich</b></span>
	<span class="span-header center" style="margin-left: 20px"><b>Reichweite</b></span>
	<span class="span-header center" style="margin-left: 30px"><b>Wirkungsdauer</b></span>
	<span class="span-header center" style="margin-left: 10px"><b>Ziel</b></span>
	<span class="span-header center" style="margin-left: 75px"><b>Art</b></span>
	<span class="span-header center" style="margin-left: 80px"><b>Prozess</b></span>
	<span class="span-header center" style="margin-left: 80px"><b>PP</b></span>
	<span class="span-header center" style="margin-left: 25px"><b>KBlatt</b></span>
	<fieldset class="repeating_zauber">
		<input type="hidden" class="repeating-show" name="attr_repeating_show" value="1">
		<div class="repeating-display">
			<button type='roll'
				value='&{template:default} {{name=@{character_name} zaubert @{Zauber}}} {{EW:Zaubern=[[1D20 + @{Zaubern} + @{ZauSpezBonus} + @{BonusZauber} + @{itemBZaubern} + @{modZaubern} + ?{Bonus|0} ]]}} {{AP=@{AP}}} {{Zauberdauer=@{Zd}}} {{Wirkungsbereich=@{Wb}}} {{Reichweite=@{Rw}}} {{Wirkungsdauer=@{Wd}}} {{Ziel=@{ziel}}} {{Art=@{art}}}'
				name="roll_EW_Zaubern"></button>
			<input type='checkbox' class="checkbox" name='attr_toggle-section' value="1">
			<input class='sheet-section-toggle' type='hidden' name='attr_toggle-section'>
			<input type="text" name="attr_Zauber" value="Name" />
			<input type="number" name="attr_ZauSpezBonus" value="0" />
			<input type="text" name="attr_AP" style="width:100px" value="AP" />
			<input type="text" name="attr_ZD" style="width:100px" value="Zd" />
			<input type="text" name="attr_WB" style="width:100px" value="Wb" />
			<input type="text" name="attr_RW" style="width:100px" value="Rw" />
			<input type="text" name="attr_WD" style="width:100px" value="Wd" />
			<select name="attr_Ziel" class="ziel">
				<option value="Ziel" selected="selected">Ziel</option>
				<option value="Umgebung">Umgebung</option>
				<option value="Geist">Geist</option>
				<option value="Körper">Körper</option>
			</select>
			<select name="attr_Art" class="art">
				<option value="Art" selected="selected">Art</option>
				<option value="Gedanke">Gedanke</option>
				<option value="Geste">Geste</option>
				<option value="Wort">Wort</option>
			</select>
			<select name="attr_Prozess" class="prozess">
				<option value="Prozess" selected="selected">Prozess</option>
				<option value="Ohne">Ohne</option>
				<option value="Beherrschen">Beherrschen</option>
				<option value="Bewegen">Bewegen</option>
				<option value="Erkennen">Erkennen</option>
				<option value="Erschaffen">Erschaffen</option>
				<option value="Formen">Formen</option>
				<option value="Verändern">Verändern</option>
				<option value="Zerstören">Zerstören</option>
				<option value="Wundertat">Wundertat</option>
				<option value="Dweomer">Dweomer</option>
				<option value="Zauberlied">Zauberlied</option>
				<option value="Salz">Salz</option>
				<option value="Thaumagraphie">Thaumagraphie</option>
				<option value="Beschwören">Beschwören</option>
				<option value="Nekromantie">Nekromantie</option>
				<option value="Thaumatherapie">Thaumatherapie</option>
				<option value="Zaubermittel">Zaubermittel</option>
				<option value="Zauberschutz">Zauberschutz</option>
			</select>
			<input type="number" name="attr_ZauPP" value="0" />
			<input type="checkbox" class="checkbox" value="1" name="attr_ZauKB" style="margin-left: 10px" />
			<div class="sheet-section-hide">
				<textarea name="attr_ZauWirkung"></textarea>
			</div>
		</div>
	</fieldset>

	<br />
	<div class="2colrow">
		<div class="col">

			<h3>Angriff</h3> <br />

			<span class="span-header center" style="margin-left: 32px"><b>Fk</b></span>
			<span class="span-header center" style="margin-left: 2px"><b>Waffe</b></span>
			<span class="span-header center" style="margin-left: 130px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 18px"><b>Spz.</b></span>
			<span class="span-header center" style="margin-left: 0px"><b>Schaden</b></span>
			<span class="span-header center" style="margin-left: 10px"><b>AnB</b></span>
			<span class="span-header center" style="margin-left: 1px"><b>Sc.B</b></span>
			<span class="span-header center" style="margin-left: 3px"><b>Rng</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>EW</b></span>
			<span class="span-header center" style="margin-left: 7px"><b>SB</b></span>
			<span class="span-header center" style="margin-left: 15px"><b>PP</b></span>

			<fieldset class="repeating_angriff">
				<button type='roll'
					value='&{template:default} {{name=@{character_name} greift an}} {{EW:@{Waffe}=[[1d20 + @{WaffeEW} + ?{Bonus|0}]]}} {{Schaden=[[@{WaffeSchaden} + @{WaffeEfSchB}]]}}'
					name="roll_EW_Angriff"></button>
				<input type="checkbox" class="checkbox" name="attr_FKWaffe" value="1" />
				<input type="text" name="attr_Waffe" value="Name" />
				<input type="text" name="attr_FWWaffe" style="width:40px" value="0" />
				<input type="text" name="attr_SpezWaffe" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeSchaden" style="width:60px" value="1D6+?" />
				<input type="text" name="attr_WaffeAngB" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeSchB" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeRang" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeEW" style="width:30px" value="0" readonly />
				<input type="text" name="attr_WaffeEfSchB" style="width:30px" value="0" readonly />
				<input type="number" name="attr_WaffePP" style="width:40px" value="0" />
			</fieldset>

			<br />
			<h3>Fertigkeiten</h3> <br />

			<span class="span-header center" style="margin-left: 35px"><b>R</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>Fertigkeit</b></span>
			<span class="span-header center" style="margin-left: 105px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 90px"><b>Bonus</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>PP</b></span>
			<span class="span-header center" style="margin-left: 27px"><b>KBlatt</b></span>

			<fieldset class="repeating_fertigkeiten">
				<input type="hidden" class="repeating-show" name="attr_repeating_show" value="1">
				<div class="repeating-display">
					<button type='roll' name="roll_ew_fertigkeit"
						value='&{template:default} {{name=@{character_name} würfelt auf @{Fertigkeit}}} {{EW:@{Fertigkeit}=[[1d20cs16cs17cs18cs19cs20cf1cf16cf17cf18cf19 + @{FW} + @{leitE} + @{Fertigkeitsbonus} + ?{Bonus|0}]]}}'></button>
					<input type='checkbox' class="checkbox" name='attr_toggle-section' value="1">
					<input class='sheet-section-toggle' type='hidden' name='attr_toggle-section'>
					<input type="text" name="attr_Fertigkeit" value="Name" />
					<input type="number" name="attr_FW" value="0" />
					<select name="attr_LeitE" class="dtype">
						<option value="0" selected="selected">-</option>
						<option value="@{LeitSt}">St</option>
						<option value="@{LeitGs}">Gs</option>
						<option value="@{LeitGw}">Gw</option>
						<option value="@{LeitKo}">Ko</option>
						<option value="@{LeitIn}">In</option>
						<option value="@{LeitZt}">Zt</option>
						<option value="@{LeitAu}">Au</option>
						<option value="@{LeitpA}">pA</option>
						<option value="@{LeitWk}">Wk</option>
					</select>
					<input type="number" name="attr_Fertigkeitsbonus" value="0" />
					<input type="number" name="attr_FertPP" value="0" />
					<input type="checkbox" class="checkbox" style="margin-left: 12px" value="1" name="attr_FertKB" />
					<div class="sheet-section-hide">
						<textarea name="attr_FertBeschreibung"></textarea>
					</div>
				</div>
			</fieldset>
		</div>


		<div class="col">

			<h3>Abwehr</h3> <br />

			<span class="span-header center" style="margin-left: 35px"><b>Waffe</b></span>
			<span class="span-header center" style="margin-left: 130px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 15px"><b>AbwB</b></span>
			<span class="span-header center" style="margin-left: 10px"><b>AP</b></span>
			<span class="span-header center" style="margin-left: 17px"><b>WW</b></span>
			<span class="span-header center" style="margin-left: 20px"><b>PP</b></span>

			<fieldset class="repeating_abwehr">
				<button type='roll'
					value='&{template:default} {{name=@{character_name} wehrt ab}} {{WW:@{AbwWaffe}=[[1d20 + @{AbwWaffeWW} + ?{Bonus|0}]]}}'
					name="roll_WW_Abwehr"></button>
				<input type="text" name="attr_AbwWaffe" value="Name" />
				<input type="number" name="attr_FWAbwWaffe" style="width:40px" value="0" />
				<input type="number" name="attr_WaffeAbwB" style="width:40px" value="0" />
				<input type="number" name="attr_AbwWAP" style="width:40px" value="0" />
				<input type="number" name="attr_AbwWaffeWW" style="width:40px"
					value="@{Abwehr} + @{FWAbwWaffe} + @{WaffeAbwB} + @{BonusAbwehr} + @{ItemBAbwehr} + @{modAbwehr} + @{gRüsAbwB}"
					disabled="true" />
				<input type="number" name="attr_AbWWaffePP" style="width:40px" value="0" />
			</fieldset>

			<br />
			<h3>Rüstung</h3> <br />

			<span class="span-header center" style="margin-left: 30px"><b>Rüstung</b></span>
			<span class="span-header center" style="margin-left: 50px"><b>LP</b></span>
			<span class="span-header center" style="margin-left: 20px"><b>AP</b></span>
			<span class="span-header center" style="margin-left: 25px"><b>AnB</b></span>
			<span class="span-header center" style="margin-left: 15px"><b>AbB</b></span>
			<span class="span-header center" style="margin-left: 10px"><b>B</b></span>
			<span class="span-header center" style="margin-left: 40px"><b>Gw</b></span>

			<fieldset class="repeating_ruestung">
				<input type="checkbox" class="checkbox" value="1" name="attr_RsGetragen" style="margin-left: 10px"
					readonly />
				<input type="text" name="attr_Rüstung" style="width:100px" value="Name" />
				<input type="number" name="attr_RüsLP" style="width:40px" value="0" />
				<input type="number" name="attr_RüsAP" style="width:40px" value="0" />
				<input type="number" name="attr_RüsAnB" style="width:40px" value="0" />
				<input type="number" name="attr_RüsAbwB" style="width:40px" value="0" />
				<input type="number" name="attr_RüsB" style="width:50px" value="0" />
				<input type="number" name="attr_RüsGw" style="width:50px" value="0" />
				<button type='action' name='act_anlegen'>An&#47;Ablegen</button>
			</fieldset>
		</div>

	</div>
</div> -->

<div class='sheet-Ausrustung'>
	<h2>Ausrüstung</h2>
	<div class="2colrow">
		<div class="col">
			<textarea name="attr_Ausrüstung1"></textarea>
		</div>
		<div class="col">
			<textarea name="attr_Ausrüstung2"></textarea>
		</div>
	</div>
</div>

<div class='sheet-Notizen'>
	<h2>Notizen</h2>
	<div class="2colrow">
		<div class="col">
			<textarea name="attr_Notiz1"></textarea>
		</div>
		<div class="col">
			<textarea name="attr_Notiz2"></textarea>
		</div>
	</div>
</div>
<!--
<div class='sheet-NSC'>
	<h2>Nichtspielerfiguren</h2>
	<div class="3colrow">

		<div class="col">

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Stärke}} {{Der Wurf Ist um [[@{St} +@{ItemBStärke} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Stärke von [[@{St}+@{ItemBStärke}]]!}}'
				name="roll_PW_St"></button>
			<label>Stärke</label><input type="number" name="attr_St" value="1" /><span> Bonus </span><input
				type="number" name="attr_ItemBStärke" value="0" /><br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Geschicklichkeit}} {{Der Wurf Ist um [[@{Gs} + @{ItemBGeschick}- 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Geschicklichkeit von [[@{Gs}+@{ItemBGeschick}]]!}}'
				name="roll_PW_Gs"></button>
			<label>Geschick</label><input type="number" name="attr_Gs" value="1" /> <span> Bonus </span><input
				type="number" name="attr_ItemBGeschick" value="0" /><br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Gewandtheit}} {{Der Wurf Ist um [[@{Gw} + @{ItemBGewandheit} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Gewandtheit von [[@{Gw}+@{ItemBGewandheit}]]!}}'
				name="roll_PW_Gw"></button>
			<label>Gewandheit</label><input type="number" name="attr_Gw" value="1" /> <span> Bonus </span><input
				type="number" name="attr_ItemBGewandheit" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Konstitution}} {{Der Wurf Ist um [[@{Ko} + @{ItemBKonstitution} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Konstitution von [[@{Ko}+@{ItemBKonstitution}]]!}}'
				name="roll_PW_Ko"></button>
			<label>Konstitution</label><input type="number" name="attr_Ko" value="1" /><span> Bonus </span><input
				type="number" name="attr_ItemBKonstitution" value="0" /> <br />

		</div>

		<div class="col">
			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Intelligenz}} {{Der Wurf Ist um [[@{In} + @{ItemBIntelligenz}- 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Intelligenz von [[@{In}+@{ItemBIntelligenz}]]!}}'
				name="roll_PW_In"></button>
			<label>Intelligenz</label><input type="number" name="attr_In" value="1" /><span> Bonus </span><input
				type="number" name="attr_ItemBIntelligenz" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Zaubertalent}} {{Der Wurf Ist um [[@{Zt} + @{ItemBZaubertalent} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Zaubertalent von [[@{Zt}+@{ItemBZaubertalent}]]!}}'
				name="roll_PW_Zt"></button>
			<label>Zaubertalent</label><input type="number" name="attr_Zt" value="1" /> <span> Bonus </span><input
				type="number" name="attr_ItemBZaubertalent" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Aussehen}} {{Der Wurf Ist um [[@{Au} + @{ItemBAussehen} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Aussehen von [[@{Au}!+@{ItemBAussehen}]]}}'
				name="roll_PW_Au"></button>
			<label>Aussehen</label><input type="number" name="attr_Au" value="1" /> <span> Bonus </span><input
				type="number" name="attr_ItemBAussehen" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf persönliche Ausstrahlung}} {{Der Wurf Ist um [[@{pA} + @{ItemBpA} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für persönliche Ausstrahlung von [[@{pA}+@{ItemBpA}]]!}}'
				name="roll_PW_pA"></button>
			<label>pers.Ausstrahl.</label><input type="number" name="attr_pA" value="1" /> <span> Bonus </span><input
				type="number" name="attr_ItemBpA" value="0" /> <br />

		</div>

		<div class="col">
			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Willenskraft}} {{Der Wurf Ist um [[@{Wk} + @{ItemBWillenskraft}- 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Willenskraft von [[@{Wk}+@{ItemBWillenskraft}]]!}}'
				name="roll_PW_Wk"></button>
			<label>Willenskraft</label><input type="number" name="attr_Wk" value="1" /><span> Bonus </span><input
				type="number" name="attr_ItemBWillenskraft" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Gifttoleranz}} {{Der Wurf Ist um [[@{GiT} + @{ItemBGifttoleranz} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Gifttoleranz von [[@{GiT}+@{ItemBGifttoleranz}]]!}}'
				name="roll_PW_GiT"></button>
			<label>Gifttoleranz</label><input type="number" name="attr_GiT" value="30+floor(@{Ko}/2)" disabled="true" />
			<span> Bonus </span><input type="number" name="attr_ItemBGifttoleranz" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt auf Geistesblitz}} {{Der Wurf Ist um [[@{GBlitz} + @{ItemBGeistesblitz} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Geistesblitz von [[@{GBlitz}+@{ItemBGeistesblitz}]]!}}'
				name="roll_PW_GBlitz"></button>
			<label>Geistesblitz</label><input type="number" name="attr_GBlitz"
				value="floor((@{In}+@{itemBIntelligenz})/10)" disabled="true" /> <span> Bonus </span><input
				type="number" name="attr_ItemBGeistesblitz" value="0" /> <br />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} würfelt aufn Kraftakt}}  {{Der Wurf Ist um [[@{KraftaktW} + @{ItemBKraftakt} - 1d100cs1cf100 - ?{Zuschlag auf Würfelwurf(PW)|0}]] besser als der Wert für Kraftaktwert von [[@{KraftaktW}+@{ItemBKraftakt}]]!}}'
				name="roll_PW_KAW"></button>
			<label>Kraftakt</label><input type="number" name="attr_KraftaktW" value="floor((@{St}+@{ItemBStärke})/10)"
				disabled="true" /> <span> Bonus </span><input type="number" name="attr_ItemBKraftakt" value="0" />
		</div>
	</div>
	<br />
	<div class="2colrow">
		<div class="col">

			<button type='roll'
				value='&{template:default} {{name=@{character_name}}} {{EW:Raufen=[[1d20 + @{Raufen} + @{ItemBRaufen} + ?{Bonus|0}]]}} {{Schaden=[[1d6 + @{BonusSchaden} + @{ItemBRaufenSch} +@{modSchaden}]]}}'
				name="roll_EW_Raufen"></button>
			<span><b>Raufen</b> </span><input type="number" name="attr_Raufen"
				value="floor((@{St}+@{ItemBStärke}+@{Gw}+@{ItemBGewandheit})/20)+@{BonusAngriff} + @{gRüsAnB}"
				disabled="true" />
			<span> Bonus </span><input type="number" name="attr_ItemBRaufen" value="0" />
			<span> Sch.B </span><input type="number" name="attr_ItemBRaufenSch" value="0" />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} resistiert}} {{WW:Geist=[[1D20 + @{KampfResG} + ?{Bonus|0}]]}}'
				name="roll_WW_Geist"></button>
			<span><b>ResG</b> </span> <input type="number" name="attr_KampfResG"
				value="@{ResGeist} + @{ItemBResG} + @{BonusResG} + @{modResG}" disabled="true" />

			<button type='roll'
				value='&{template:default} {{name=@{character_name} resistiert}} {{WW:Körper=[[1D20 + @{KampfResK} + ?{Bonus|0}]]}}'
				name="roll_WW_Koerper"></button>
			<span><b>ResK</b> </span> <input type="number" name="attr_KampfResK"
				value="@{ResKörper} + @{ItemBResK} + @{BonusResK} + @{modResK}" disabled="true" />

			<br />
			<button type='roll'
				value='&{template:default} {{name=@{character_name}}} {{Handlungsrang=[[@{aktGw} &{tracker}]]}}'
				name="roll_Handlungsrang"></button>
			<span><b>Handlungsrang</b></span><input type="number" name="attr_aktGw" style="width:60px"
				value="@{GW} + @{ItemBGewandheit} + @{ModGw} + @{gRusGW}" disabled="true" />
			<span><b>LP </b></span><input type="number" name="attr_LP" value="0" /> <span> / </span> <input
				type="number" name="attr_LP_max" value="0" readonly />
			<span><b>AP </b></span><input type="number" name="attr_AP" value="0" /> <span> / </span> <input
				type="number" name="attr_AP_max" value="0" readonly />
			<span><b>B </b></span> <input type="number" name="attr_aktB" value="@{B} + @{ItemBB} + @{ModB} +@{gRüsB}"
				disabled="true" />

			<br /><br />
			<h3>Angriff</h3> <br />

			<span class="span-header center" style="margin-left: 32px"><b>Fk</b></span>
			<span class="span-header center" style="margin-left: 2px"><b>Waffe</b></span>
			<span class="span-header center" style="margin-left: 130px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 18px"><b>Spz.</b></span>
			<span class="span-header center" style="margin-left: 0px"><b>Schaden</b></span>
			<span class="span-header center" style="margin-left: 10px"><b>AnB</b></span>
			<span class="span-header center" style="margin-left: 1px"><b>Sc.B</b></span>
			<span class="span-header center" style="margin-left: 3px"><b>Rng</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>EW</b></span>
			<span class="span-header center" style="margin-left: 7px"><b>SB</b></span>
			<span class="span-header center" style="margin-left: 15px"><b>PP</b></span>

			<fieldset class="repeating_angriff">
				<button type='roll'
					value='&{template:default} {{name=@{character_name} greift an}} {{EW:@{Waffe}=[[1d20 + @{WaffeEW} + ?{Bonus|0}]]}} {{Schaden=[[@{WaffeSchaden} + @{WaffeEfSchB}]]}}'
					name="roll_EW_Angriff"></button>
				<input type="checkbox" class="checkbox" name="attr_FKWaffe" value="1" />
				<input type="text" name="attr_Waffe" value="Name" />
				<input type="text" name="attr_FWWaffe" style="width:40px" value="0" />
				<input type="text" name="attr_SpezWaffe" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeSchaden" style="width:60px" value="1D6+?" />
				<input type="text" name="attr_WaffeAngB" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeSchB" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeRang" style="width:30px" value="0" />
				<input type="text" name="attr_WaffeEW" style="width:30px" value="0" readonly />
				<input type="text" name="attr_WaffeEfSchB" style="width:30px" value="0" readonly />
				<input type="number" name="attr_WaffePP" style="width:40px" value="0" />
			</fieldset>

			<br />
			<h3>Rüstung</h3> <br />

			<span class="span-header center" style="margin-left: 30px"><b>Rüstung</b></span>
			<span class="span-header center" style="margin-left: 50px"><b>LP</b></span>
			<span class="span-header center" style="margin-left: 20px"><b>AP</b></span>
			<span class="span-header center" style="margin-left: 25px"><b>AnB</b></span>
			<span class="span-header center" style="margin-left: 15px"><b>AbB</b></span>
			<span class="span-header center" style="margin-left: 10px"><b>B</b></span>
			<span class="span-header center" style="margin-left: 40px"><b>Gw</b></span>

			<fieldset class="repeating_ruestung">
				<input type="checkbox" class="checkbox" value="1" name="attr_RsGetragen" style="margin-left: 10px"
					readonly />
				<input type="text" name="attr_Rüstung" style="width:100px" value="Name" />
				<input type="number" name="attr_RüsLP" style="width:40px" value="0" />
				<input type="number" name="attr_RüsAP" style="width:40px" value="0" />
				<input type="number" name="attr_RüsAnB" style="width:40px" value="0" />
				<input type="number" name="attr_RüsAbwB" style="width:40px" value="0" />
				<input type="number" name="attr_RüsB" style="width:50px" value="0" />
				<input type="number" name="attr_RüsGw" style="width:50px" value="0" />
				<button type='action' name='act_anlegen'>An&#47;Ablegen</button>
			</fieldset>

		</div>


		<div class="col">

			<span><b>Modifikationen:</b></span>
			<span><b>Rang</b></span><input type="number" name="attr_ModGw" style="width:60px" value="0" />
			<span><b>Angriff</b></span><input type="number" name="attr_modAngriff" value="0" />
			<span style="margin-left: 4px"><b>Abwehr</b></span><input type="number" name="attr_modAbwehr" value="0" />
			<span style="margin-left: 4px"><b>B </b></span><input type="number" name="attr_modB" value="0" />
			<br />
			<span><b>Schaden</b></span><input type="number" name="attr_modSchaden" value="0" />
			<span style="margin-left: 10px"><b>ResG</b></span><input type="number" name="attr_modResG" value="0" />
			<span style="margin-left: 10px"><b>ResK</b></span><input type="number" name="attr_modResK" value="0" />
			<span><b>Zaubern</b></span><input type="number" name="attr_modZaubern" value="0" />
			<br />

			<br />

			<h3>Abwehr</h3> <br />

			<span class="span-header center" style="margin-left: 35px"><b>Waffe</b></span>
			<span class="span-header center" style="margin-left: 130px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 15px"><b>AbwB</b></span>
			<span class="span-header center" style="margin-left: 10px"><b>AP</b></span>
			<span class="span-header center" style="margin-left: 17px"><b>WW</b></span>
			<span class="span-header center" style="margin-left: 20px"><b>PP</b></span>

			<fieldset class="repeating_abwehr">
				<button type='roll'
					value='&{template:default} {{name=@{character_name} wehrt ab}} {{WW:@{AbwWaffe}=[[1d20 + @{AbwWaffeWW} + ?{Bonus|0}]]}}'
					name="roll_WW_Abwehr"></button>
				<input type="text" name="attr_AbwWaffe" value="Name" />
				<input type="number" name="attr_FWAbwWaffe" style="width:40px" value="0" />
				<input type="number" name="attr_WaffeAbwB" style="width:40px" value="0" />
				<input type="number" name="attr_AbwWAP" style="width:40px" value="0" />
				<input type="number" name="attr_AbwWaffeWW" style="width:40px"
					value="@{Abwehr} + @{FWAbwWaffe} + @{WaffeAbwB} + @{BonusAbwehr} + @{ItemBAbwehr} + @{modAbwehr} + @{gRüsAbwB}"
					disabled="true" />
				<input type="number" name="attr_AbWWaffePP" style="width:40px" value="0" />
			</fieldset>

			<br />
			<h3>Fertigkeiten</h3> <br />

			<span class="span-header center" style="margin-left: 35px"><b>R</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>Fertigkeit</b></span>
			<span class="span-header center" style="margin-left: 105px"><b>FW</b></span>
			<span class="span-header center" style="margin-left: 90px"><b>Bonus</b></span>
			<span class="span-header center" style="margin-left: 5px"><b>PP</b></span>
			<span class="span-header center" style="margin-left: 27px"><b>KBlatt</b></span>

			<fieldset class="repeating_fertigkeiten">
				<input type="hidden" class="repeating-show" name="attr_repeating_show" value="1">
				<div class="repeating-display">
					<button type='roll' name="roll_ew_fertigkeit"
						value='&{template:default} {{name=@{character_name} würfelt auf @{Fertigkeit}}} {{EW:@{Fertigkeit}=[[1d20cs16cs17cs18cs19cs20cf1cf16cf17cf18cf19 + @{FW} + @{leitE} + @{Fertigkeitsbonus} + ?{Bonus|0}]]}}'></button>
					<input type='checkbox' class="checkbox" name='attr_toggle-section' value="1">
					<input class='sheet-section-toggle' type='hidden' name='attr_toggle-section'>
					<input type="text" name="attr_Fertigkeit" value="Name" />
					<input type="number" name="attr_FW" value="0" />
					<select name="attr_LeitE" class="dtype">
						<option value="0" selected="selected">-</option>
						<option value="@{LeitSt}">St</option>
						<option value="@{LeitGs}">Gs</option>
						<option value="@{LeitGw}">Gw</option>
						<option value="@{LeitKo}">Ko</option>
						<option value="@{LeitIn}">In</option>
						<option value="@{LeitZt}">Zt</option>
						<option value="@{LeitAu}">Au</option>
						<option value="@{LeitpA}">pA</option>
						<option value="@{LeitWk}">Wk</option>
					</select>
					<input type="number" name="attr_Fertigkeitsbonus" value="0" />
					<input type="number" name="attr_FertPP" value="0" />
					<input type="checkbox" class="checkbox" style="margin-left: 12px" value="1" name="attr_FertKB" />
					<div class="sheet-section-hide">
						<textarea name="attr_FertBeschreibung"></textarea>
					</div>
				</div>
			</fieldset>
		</div>

	</div>

	<br />
	<h3>Zauber</h3> <br />

	<span class="span-header center" style="margin-left: 35px"><b>R</b></span>
	<span class="span-header center" style="margin-left: 5px"><b>Zauber</b></span>
	<span class="span-header center" style="margin-left: 120px"><b>Bonus</b></span>
	<span class="span-header center" style="margin-left: 5px"><b>AP</b></span>
	<span class="span-header center" style="margin-left: 85px"><b>Zauberdauer</b></span>
	<span class="span-header center" style="margin-left: 20px"><b>Wirk.Bereich</b></span>
	<span class="span-header center" style="margin-left: 20px"><b>Reichweite</b></span>
	<span class="span-header center" style="margin-left: 30px"><b>Wirkungsdauer</b></span>
	<span class="span-header center" style="margin-left: 10px"><b>Ziel</b></span>
	<span class="span-header center" style="margin-left: 75px"><b>Art</b></span>
	<span class="span-header center" style="margin-left: 80px"><b>Prozess</b></span>
	<span class="span-header center" style="margin-left: 80px"><b>PP</b></span>
	<span class="span-header center" style="margin-left: 25px"><b>KBlatt</b></span>
	<fieldset class="repeating_zauber">
		<input type="hidden" class="repeating-show" name="attr_repeating_show" value="1">
		<div class="repeating-display">
			<button type='roll'
				value='&{template:default} {{name=@{character_name} zaubert @{Zauber}}} {{EW:Zaubern=[[1D20 + @{Zaubern} + @{ZauSpezBonus} + @{BonusZauber} + @{itemBZaubern} + @{modZaubern} + ?{Bonus|0} ]]}} {{AP=@{AP}}} {{Zauberdauer=@{Zd}}} {{Wirkungsbereich=@{Wb}}} {{Reichweite=@{Rw}}} {{Wirkungsdauer=@{Wd}}} {{Ziel=@{ziel}}} {{Art=@{art}}}'
				name="roll_EW_Zaubern"></button>
			<input type='checkbox' class="checkbox" name='attr_toggle-section' value="1">
			<input class='sheet-section-toggle' type='hidden' name='attr_toggle-section'>
			<input type="text" name="attr_Zauber" value="Name" />
			<input type="number" name="attr_ZauSpezBonus" value="0" />
			<input type="text" name="attr_AP" style="width:100px" value="AP" />
			<input type="text" name="attr_ZD" style="width:100px" value="Zd" />
			<input type="text" name="attr_WB" style="width:100px" value="Wb" />
			<input type="text" name="attr_RW" style="width:100px" value="Rw" />
			<input type="text" name="attr_WD" style="width:100px" value="Wd" />
			<select name="attr_Ziel" class="ziel">
				<option value="Ziel" selected="selected">Ziel</option>
				<option value="Umgebung">Umgebung</option>
				<option value="Geist">Geist</option>
				<option value="Körper">Körper</option>
			</select>
			<select name="attr_Art" class="art">
				<option value="Art" selected="selected">Art</option>
				<option value="Gedanke">Gedanke</option>
				<option value="Geste">Geste</option>
				<option value="Wort">Wort</option>
			</select>
			<select name="attr_Prozess" class="prozess">
				<option value="Prozess" selected="selected">Prozess</option>
				<option value="Ohne">Ohne</option>
				<option value="Beherrschen">Beherrschen</option>
				<option value="Bewegen">Bewegen</option>
				<option value="Erkennen">Erkennen</option>
				<option value="Erschaffen">Erschaffen</option>
				<option value="Formen">Formen</option>
				<option value="Verändern">Verändern</option>
				<option value="Zerstören">Zerstören</option>
				<option value="Wundertat">Wundertat</option>
				<option value="Dweomer">Dweomer</option>
				<option value="Zauberlied">Zauberlied</option>
				<option value="Salz">Salz</option>
				<option value="Thaumagraphie">Thaumagraphie</option>
				<option value="Beschwören">Beschwören</option>
				<option value="Nekromantie">Nekromantie</option>
				<option value="Thaumatherapie">Thaumatherapie</option>
				<option value="Zaubermittel">Zaubermittel</option>
				<option value="Zauberschutz">Zauberschutz</option>
			</select>
			<input type="number" name="attr_ZauPP" value="0" />
			<input type="checkbox" class="checkbox" value="1" name="attr_ZauKB" style="margin-left: 10px" />
			<div class="sheet-section-hide">
				<textarea name="attr_ZauWirkung"></textarea>
			</div>
		</div>
	</fieldset>

</div>
 -->
<script type="text/worker">
	const SheetVersion = "2";
	const buttonlist = ["Datenblatt", "Fertigkeiten", "Sprachen", "Zauber", "KampfK", "KampfZ", "Ausrustung", "Notizen", "NSC"];
	buttonlist.forEach(button => {
		on(`clicked:${button}`, function () {
			console.log("Button " + button);
			setAttrs({
				sheetTab: button
			});
		});
	});

	// prüfen ob Defaultwerte geschrieben werden müssen

	on("sheet:opened", function () {
		getAttrs(["gRüsB", "gRusGW", "gRüsAbwB", "gRüsAnB", "gSchB"], function (values) {


			if (values.gRusGW == undefined) setAttrs({
				"gRusGW": "0"
			});
			if (values.gRüsAbwB == undefined) setAttrs({
				"gRüsAbwB": "0"
			});
			if (values.gRüsAnB == undefined) setAttrs({
				"gRüsAnB": "0"
			});
			if (values.gRüsB == undefined) setAttrs({
				"gRüsB": "0"
			});
			if (values.gSchB == undefined) setAttrs({
				"gSchB": "0"
			});
			if (values.gAngB == undefined) setAttrs({
				"gAngB": "0"
			});
		});
	});

	// Gesamtangriffsbonus berechnen

	on("change:BonusAngriff change:modAngriff change:gRüsAnB sheet:opened", function () {
		getAttrs(["BonusAngriff",
			"modAngriff",
			"gRüsAnB"
		], function (values) {
			var gAngB = (parseInt(values.BonusAngriff, 10) || 0) + (parseInt(values.modAngriff, 10) || 0) + (parseInt(values.gRüsAnB, 10) || 0);
			setAttrs({
				"gAngB": gAngB
			});
		})
	});

	// Gesamtschadensbonus berechnen

	on("change:BonusSchaden change:modSchaden sheet:opened", function () {
		getAttrs(["BonusSchaden",
			"modSchaden"
		], function (values) {
			var gSchB = (parseInt(values.BonusSchaden, 10) || 0) + (parseInt(values.modSchaden, 10) || 0);
			setAttrs({
				"gSchB": gSchB
			});
		})
	});

	// Werte von Waffen neu berechnen

	on("change:repeating_angriff change:gSchB change:gAngB sheet:opened", function (eventinfo) {

		// Loop über alle Waffen 

		getSectionIDsOrdered("repeating_angriff", function (idarray) {
			var setWaffe = {}; // Waffen

			_.each(idarray, function (currentID, i) {
				// Daten der aktuellen Zeile holen
				getAttrs(['repeating_angriff_' + currentID + '_FKWaffe',
					'repeating_angriff_' + currentID + '_Waffe',
					'repeating_angriff_' + currentID + '_FWWaffe',
					'repeating_angriff_' + currentID + '_SpezWaffe',
					'repeating_angriff_' + currentID + '_WaffeSchaden',
					'repeating_angriff_' + currentID + '_WaffeSchB',
					'repeating_angriff_' + currentID + '_WaffeAngB',
					'repeating_angriff_' + currentID + '_WaffeRang',
					'repeating_angriff_' + currentID + '_WaffeEW',
					'repeating_angriff_' + currentID + '_WaffeEfSchB',
					'modSchaden',
					'BonusSchaden',
					'gAngB',
				], function (values) {
					var WaffeSchB = 0;
					var WaffeEW = 0;
					// Wenn die angelegte Waffe eine Fernkampfwaffe ist, den Schadensbonus aus den Grundattributen nicht reinrechnen. Bei Nahkampfwaffen mit reinrechnen						  
					if (values['repeating_angriff_' + currentID + '_FKWaffe'] == true) {

						WaffeSchB = (parseInt(values['repeating_angriff_' + currentID + '_WaffeSchB'], 10) || 0) + (parseInt(values.modSchaden, 10) || 0);

					} else {

						WaffeSchB = (parseInt(values['repeating_angriff_' + currentID + '_WaffeSchB'], 10) || 0) + (parseInt(values.modSchaden, 10) || 0) + (parseInt(values.BonusSchaden, 10) || 0);

					};

					WaffeEW = (parseInt(values['repeating_angriff_' + currentID + '_FWWaffe'], 10) || 0) + (parseInt(values['repeating_angriff_' + currentID + '_SpezWaffe'], 10) || 0) + (parseInt(values['repeating_angriff_' + currentID + '_WaffeAngB'], 10) || 0) + (parseInt(values.gAngB, 10) || 0);

					setWaffe['repeating_angriff_' + currentID + '_WaffeEfSchB'] = WaffeSchB;
					setWaffe['repeating_angriff_' + currentID + '_WaffeEW'] = WaffeEW;
					setAttrs(setWaffe);
				});

			});
		});

	});

	// Rüstung anlegen

	//	on("change:repeating_ruestung:RsGetragen", function(eventinfo) {
	on("clicked:repeating_ruestung:anlegen change:repeating_ruestung:RüsAnB change:repeating_ruestung:RüsAbwB change:repeating_ruestung:RüsB change:repeating_ruestung:RüsGW", function (eventinfo) {
		getAttrs(["repeating_ruestung_RsGetragen"], function (values) {
			var actrow = extractCurrentId(eventinfo); // Die augenblickliche Zeile
			var ereignis = extractEvent(eventinfo);
			var actrowstore = "";
			var rusgetragen = values.repeating_ruestung_RsGetragen;
			actrow = actrow.toUpperCase();
			actrowstore = actrow; // Für das wegschreiben der Variable

			console.log("Rüstung Start " + eventinfo.sourceAttribute + " " + actrow + " " + values.repeating_ruestung_RsGetragen);

			// Trageflag toggeln
			if (ereignis == "anlegen") {
				if (rusgetragen == false) {
					console.log("Rüstung anlegen " + actrow);
					rusgetragen = true;
				} else {
					console.log("Rüstung ablegen " + actrow);
					rusgetragen = false;
				};

				if (rusgetragen == false) {
					actrowstore = ""; // Initialisieren wenn Rüstung abgelegt
				};

				console.log("Rüstung Toggle " + actrow);
				setAttrs({
					"RüstungAngelegt": actrowstore,
				});
			};

			// Loop über Rüstungen und alles außer actrow entflaggen	

			getSectionIDsOrdered("repeating_ruestung", function (idarray) {
				var setRustung = {}; // Fertigkeitenliste auf Kampfblatt

				_.each(idarray, function (currentID, i) {
					// Akuell getragene Rüstung holen 
					getAttrs(['repeating_ruestung_' + currentID + '_RsGetragen',
						'repeating_ruestung_' + currentID + '_RüsAnB',
						'repeating_ruestung_' + currentID + '_RüsAbwB',
						'repeating_ruestung_' + currentID + '_RüsB',
						'repeating_ruestung_' + currentID + '_RüsGW',
					], function (values) {
						let comparecurrentid = currentID.toUpperCase();
						console.log("Rüstung wird geprüft " + comparecurrentid + " " + actrow);
						if (actrow != comparecurrentid) {
							console.log("Rüstung abgelegt" + currentID + " " + values.RüstungAngelegt);
							if (ereignis == "anlegen") { // Nur toggeln wenn der Button gedrückt wurde
								setRustung['repeating_ruestung_' + currentID + '_RsGetragen'] = false;
								setAttrs(setRustung);
							};
						} else {
							console.log("Rüstung angelegt" + currentID + " " + actrow + " " + values['repeating_ruestung_' + currentID + '_RüsGW']);

							if (ereignis == "anlegen") { // Nur toggeln wenn der Button gedrückt wurde
								setRustung['repeating_ruestung_' + currentID + '_RsGetragen'] = rusgetragen;
								setAttrs(setRustung);
							};
							// Je nachdem ob die augenblickliche Rüstung getragen wird oder nicht, Felder leeren oder setzen
							if (rusgetragen == true) {
								setAttrs({
									"gRüsAnB": values['repeating_ruestung_' + currentID + '_RüsAnB'],
									"gRüsAbwB": values['repeating_ruestung_' + currentID + '_RüsAbwB'],
									"gRusGW": values['repeating_ruestung_' + currentID + '_RüsGW'],
									"gRüsB": values['repeating_ruestung_' + currentID + '_RüsB'],
								});
							} else {
								setAttrs({
									"gRüsAnB": "0",
									"gRüsAbwB": "0",
									"gRüsB": "0",
									"gRusGW": "0",
								});
							};
						};
					});

				});
			});

		});
	});

	on("clicked:addsinnung", function () {
		console.log("Ungelernte Fertigkeiten und Sinne hinzufügen");

		AddSinneUngelernt();
	});

	// Neuberechnung der Abwehr Zaubern und Resis bei Änderung des Grades

	on("change:Grad change:KannZaubern sheet:opened", function () {

		getAttrs(["Grad", "KannZaubern"], function (values) {
			let grad = 0;
			let abwehr = 0;
			let resg = 0;
			let resk = 0;
			let zaubern = 0;
			let kannzaubern = false;

			grad = parseInt(values.Grad, 10) || 0;
			kannzaubern = parseInt(values.KannZaubern, 10) || 0;

			if (grad < 1) grad = 1;

			console.log("Neuberechnung von Abwehr, Zaubern und Resis " + "Grad: " + grad + " Zauberer: " + kannzaubern);

			// Werte nach Grad setzen

			switch (grad) {
				case 1:
					abwehr = 11;
					resg = 11;
					resk = 11;
					zaubern = 11;
					break;
				case 2:
					abwehr = 12;
					resg = 12;
					resk = 12;
					zaubern = 12;
					break;
				case 3:
					abwehr = 12;
					resg = 12;
					resk = 12;
					zaubern = 12;
					break;
				case 4:
					abwehr = 12;
					resg = 12;
					resk = 12;
					zaubern = 13;
					break;
				case 5:
					abwehr = 13;
					resg = 13;
					resk = 13;
					zaubern = 13;
					break;
				case 6:
					abwehr = 13;
					resg = 13;
					resk = 13;
					zaubern = 14;
					break;
				case 7:
					abwehr = 13;
					resg = 13;
					resk = 13;
					zaubern = 14;
					break;
				case 8:
					abwehr = 13;
					resg = 13;
					resk = 13;
					zaubern = 15;
					break;
				case 9:
					abwehr = 13;
					resg = 13;
					resk = 13;
					zaubern = 15;
					break;
				case 10:
					abwehr = 14;
					resg = 14;
					resk = 14;
					zaubern = 16;
					break;
				case 11:
					abwehr = 14;
					resg = 14;
					resk = 14;
					zaubern = 16;
					break;
				case 12:
					abwehr = 14;
					resg = 14;
					resk = 14;
					zaubern = 16;
					break;
				case 13:
					abwehr = 14;
					resg = 14;
					resk = 14;
					zaubern = 16;
					break;
				case 14:
					abwehr = 14;
					resg = 14;
					resk = 14;
					zaubern = 16;
					break;
				case 15:
					abwehr = 15;
					resg = 15;
					resk = 15;
					zaubern = 17;
					break;
				case 16:
					abwehr = 15;
					resg = 15;
					resk = 15;
					zaubern = 17;
					break;
				case 17:
					abwehr = 15;
					resg = 15;
					resk = 15;
					zaubern = 17;
					break;
				case 18:
					abwehr = 15;
					resg = 15;
					resk = 15;
					zaubern = 17;
					break;
				case 19:
					abwehr = 15;
					resg = 15;
					resk = 15;
					zaubern = 17;
					break;
				case 20:
					abwehr = 16;
					resg = 16;
					resk = 16;
					zaubern = 18;
					break;
				case 21:
					abwehr = 16;
					resg = 16;
					resk = 16;
					zaubern = 18;
					break;
				case 22:
					abwehr = 16;
					resg = 16;
					resk = 16;
					zaubern = 18;
					break;
				case 23:
					abwehr = 16;
					resg = 16;
					resk = 16;
					zaubern = 18;
					break;
				case 24:
					abwehr = 16;
					resg = 16;
					resk = 16;
					zaubern = 18;
					break;
				case 25:
					abwehr = 17;
					resg = 17;
					resk = 17;
					zaubern = 18;
					break;
				case 26:
					abwehr = 17;
					resg = 17;
					resk = 17;
					zaubern = 18;
					break;
				case 27:
					abwehr = 17;
					resg = 17;
					resk = 17;
					zaubern = 18;
					break;
				case 28:
					abwehr = 17;
					resg = 17;
					resk = 17;
					zaubern = 18;
					break;
				case 29:
					abwehr = 17;
					resg = 17;
					resk = 17;
					zaubern = 18;
					break;
				case 30:
					abwehr = 18;
					resg = 18;
					resk = 18;
					zaubern = 18;
					break;
				default:
					abwehr = 18;
					resg = 18;
					resk = 18;
					zaubern = 18;
					break;
			};

			// Nichtzauberer haben Zaubern 3

			if (kannzaubern == false) zaubern = 3;

			// Und neue Werte wegschreiben			

			setAttrs({
				"Zaubern": zaubern,
				"Abwehr": abwehr,
				"ResGeist": resg,
				"ResKörper": resk
			});

		});
	});

	// Anpassung der Boni für Leiteigenschaften und persönlicher Bonus, wenn sich das Hauptattribut ändert	

	on('change:St change:Gw change:Gs change:Ko change:In change:Zt change:Au change:pA change:Wk change:ItemBGewandheit change:ItemBGeschick change:ItemBKonstitution change:ItemBIntelligenz change:ItemBZaubertalent change:ItemBAussehen change:ItemBpA change:ItemBWillenskraft change:ItemBStärke change:ItemBStärke change:RaKlBonusResK change:RaKlBonusResG sheet:opened', function () {
		let Attr = 0;
		let ItemBonus = 0;

		console.log("Neuberechnung der Leiteigenschaften und pers. Boni");

		getAttrs(["St", "Gs", "Gw", "Ko", "In", "Zt", "Au", "pA", "Wk", "ItemBStärke", "ItemBGeschick", "ItemBGewandheit", "ItemBKonstitution", "ItemBIntelligenz", "ItemBZaubertalent", "ItemBAussehen", "ItemBpA", "ItemBWillenskraft", "RaKlBonusResK", "RaKlBonusResG"], function (values) {
			let Attr = 0;
			let ItemBonus = 0;
			let LeitE = 0;
			let pBonus = 0;

			// persönlicher Bonus berechnen

			CalcpBonusAusdauer(values); // Ausdauer
			CalcpBonusSchaden(values); // Schaden
			CalcpBonusAngriff(values); // Angriff
			CalcpBonusAbwehr(values); // Abwehr
			CalcpBonusZaubern(values); // Abwehr			
			CalcpBonusResG(values); // Reis Geist
			CalcpBonusResK(values); // Resi Körper

			// Stärke

			Attr = parseInt(values.St, 10) || 0;
			ItemBonus = parseInt(values.ItemBStärke, 10) || 0;

			LeitE = CalcAttrBonus(Attr, ItemBonus);

			console.log("Leiteigenschaft Stärke: " + LeitE);

			setAttrs({
				leitSt: LeitE
			});

			// Gewandheit

			Attr = parseInt(values.Gw, 10) || 0;
			ItemBonus = parseInt(values.ItemBGewandheit, 10) || 0;

			LeitE = CalcAttrBonus(Attr, ItemBonus);

			console.log("Leiteigenschaft Gewandheit: " + LeitE);

			setAttrs({
				leitGw: LeitE
			});

			// Geschick

			Attr = parseInt(values.Gs, 10) || 0;
			ItemBonus = parseInt(values.ItemBGeschick, 10) || 0;

			LeitE = CalcAttrBonus(Attr, ItemBonus);

			console.log("Leiteigenschaft Geschick: " + LeitE);

			setAttrs({
				leitGs: LeitE
			});

			// Konstitution

			Attr = parseInt(values.Ko, 10) || 0;
			ItemBonus = parseInt(values.ItemBKonstitution, 10) || 0;

			LeitE = CalcAttrBonus(Attr, ItemBonus);

			console.log("Leiteigenschaft Konstitution: " + LeitE);

			setAttrs({
				leitKo: LeitE
			});

			// Intelligenz

			Attr = parseInt(values.In, 10) || 0;
			ItemBonus = parseInt(values.ItemBIntelligenz, 10) || 0;

			LeitE = CalcAttrBonus(Attr, ItemBonus);

			console.log("Leiteigenschaft Intelligenz: " + LeitE);

			setAttrs({
				leitIn: LeitE
			});

			// Zaubertalent

			Attr = parseInt(values.Zt, 10) || 0;
			ItemBonus = parseInt(values.ItemBZaubertalent, 10) || 0;

			LeitE = CalcAttrBonus(Attr, ItemBonus);

			console.log("Leiteigenschaft Zaubertalent: " + LeitE);

			setAttrs({
				leitZt: LeitE
			});

			// Aussehen

			Attr = parseInt(values.Au, 10) || 0;
			ItemBonus = parseInt(values.ItemBAussehen, 10) || 0;

			LeitE = CalcAttrBonus(Attr, ItemBonus);

			console.log("Leiteigenschaft Aussehen: " + LeitE);

			setAttrs({
				leitAu: LeitE
			});

			// persönliche Ausstrahlung

			Attr = parseInt(values.pA, 10) || 0;
			ItemBonus = parseInt(values.ItemBpA, 10) || 0;

			LeitE = CalcAttrBonus(Attr, ItemBonus);

			console.log("Leiteigenschaft pA: " + LeitE);

			setAttrs({
				leitpA: LeitE
			});

			// Willenskraft

			Attr = parseInt(values.Wk, 10) || 0;
			ItemBonus = parseInt(values.ItemBWillenskraft, 10) || 0;

			LeitE = CalcAttrBonus(Attr, ItemBonus);

			console.log("Leiteigenschaft Willenskraft: " + LeitE);

			setAttrs({
				leitWk: LeitE
			});
		});
	});

	// Versionsnummer setzen und prüfeb ob konvertiert werden muss	
	on('sheet:opened', function () {
		getAttrs(["SheetVersion"], function (values) {
			console.log("Sheet Version alt: " + values.SheetVersion + " Sheet Version neu: " + SheetVersion);

// Die allererste Version war 1.0. Deshalb diese explizit abfragen. Alle anderen Versionen werden fortlaufend nummeriert.

			if (values.SheetVersion == "1.0") {
				console.log("Upgrade von Version 1.0");
				RecalcKampfblattZauber();	
				RecalcKampfblattFertigkeiten();
				ClearFertigkeitKampfblattAlt();
				ClearZauberKampfblattAlt();
			};

			if (values.SheetVersion != SheetVersion) {

				setAttrs({
					SheetVersion: SheetVersion
				});
			};

		});
	});

	function CalcAttrBonus(Attr, ItemBonus) { // Bonus der Leiteigenschaft berechnen
		let SumAttr = Attr + ItemBonus;
		let Bonus = 0;

		if (SumAttr <= 5) {
			Bonus = -2;
		} else if (SumAttr >= 6 && SumAttr <= 20) {
			Bonus = -1;
		} else if (SumAttr >= 81 && SumAttr <= 95) {
			Bonus = 1;
		} else if (SumAttr >= 96) {
			Bonus = 2;
		}

		return Bonus;
	};

	function CalcpBonusAusdauer(values) {
		let Ko = 0;
		let St = 0;
		let Bonus = 0;

		Ko = (parseInt(values.Ko, 10) || 0) + (parseInt(values.ItemBKonstitution, 10) || 0);
		St = (parseInt(values.St, 10) || 0) + (parseInt(values.ItemBStärke, 10) || 0);

		Bonus = Math.floor(Ko / 10) + Math.floor(St / 20);

		console.log("Ausdauerbonus: " + Bonus);

		setAttrs({
			BonusAP: Bonus
		});

	};

	function CalcpBonusSchaden(values) {
		let Gs = 0;
		let St = 0;
		let Bonus = 0;

		Gs = (parseInt(values.Gs, 10) || 0) + (parseInt(values.ItemBGeschick, 10) || 0);
		St = (parseInt(values.St, 10) || 0) + (parseInt(values.ItemBStärke, 10) || 0);

		Bonus = Math.floor(St / 20) + Math.floor(Gs / 30) - 3;

		console.log("Schadensbonus: " + Bonus);

		setAttrs({
			BonusSchaden: Bonus
		});

	};

	function CalcpBonusAngriff(values) {
		let Attr = 0;
		let ItemBonus = 0;
		let Bonus = 0;

		Attr = parseInt(values.Gs, 10) || 0;
		ItemBonus = parseInt(values.ItemBGeschick, 10) || 0;

		Bonus = CalcAttrBonus(Attr, ItemBonus);

		console.log("Angriffsbonus: " + Bonus);

		setAttrs({
			BonusAngriff: Bonus
		});

	};

	function CalcpBonusAbwehr(values) {
		let Attr = 0;
		let ItemBonus = 0;
		let Bonus = 0;

		Attr = parseInt(values.Gw, 10) || 0;
		ItemBonus = parseInt(values.ItemBGewandheit, 10) || 0;

		Bonus = CalcAttrBonus(Attr, ItemBonus);

		console.log("Abwehrbonus: " + Bonus);

		setAttrs({
			BonusAbwehr: Bonus
		});

	};

	function CalcpBonusZaubern(values) {
		let Attr = 0;
		let ItemBonus = 0;
		let Bonus = 0;

		Attr = parseInt(values.Zt, 10) || 0;
		ItemBonus = parseInt(values.ItemBZaubertalent, 10) || 0;

		Bonus = CalcAttrBonus(Attr, ItemBonus);

		console.log("Bonus Zaubern: " + Bonus);

		setAttrs({
			BonusZauber: Bonus
		});

	};

	function CalcpBonusResG(values) {
		let Attr = 0;
		let ItemBonus = 0;
		let RaKlBonus = 0;
		let Bonus = 0;

		Attr = parseInt(values.In, 10) || 0;
		ItemBonus = parseInt(values.ItemBIntelligenz, 10) || 0;
		RaKlBonus = parseInt(values.RaKlBonusResG, 10) || 0;

		Bonus = (CalcAttrBonus(Attr, ItemBonus)) + RaKlBonus;

		console.log("Resistenzbonus Geist: " + Bonus);

		setAttrs({
			BonusResG: Bonus
		});

	};

	function CalcpBonusResK(values) {
		let Attr = 0;
		let ItemBonus = 0;
		let RaKlBonus = 0;
		let Bonus = 0;

		Attr = parseInt(values.Ko, 10) || 0;
		ItemBonus = parseInt(values.ItemBKonstitution, 10) || 0;
		RaKlBonus = parseInt(values.RaKlBonusResK, 10) || 0;

		Bonus = (CalcAttrBonus(Attr, ItemBonus)) + RaKlBonus;

		console.log("Resistenzbonus Körper: " + Bonus);

		setAttrs({
			BonusResK: Bonus
		});

	};

// Sinne und ungelernte Fertigkeiten hinzufügen

function AddSinneUngelernt() {

	// Konstitution für die Berechnung von Trinken holen

	getAttrs(["Ko"], function (values) {
		var setFert = {}; // Array für die Fertigkeiten
		var newrowid = 0; // ZeilenID für Fertigkeitenblatt
		var trinken = 0; // Wert für trinken
		var Ko = 0; // Konstitution für die Berechnung von Trinken

		Ko = parseInt(values.Ko, 10) || 0;
		trinken = Math.floor(Ko / 10);

		// Erstmal die Sinne 		

		setFert = setFertSinnUngelernt(setFert, "Wahrnehmung", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Sehen", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Hören", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Riechen/Schmecken", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Sechster Sinn", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Nachtsicht", "6", "0");

		// Als nächstes die ungelernten

		setFert = setFertSinnUngelernt(setFert, "Akrobatik (Ungelernt)", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Anführen (Ungelernt)", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Balancieren (Ungelernt)", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Beredsamkeit (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Betäuben (Ungelernt)", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Bootfahren (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Fallen entdecken (Ungelernt)", "0", "0");
		setFert = setFertSinnUngelernt(setFert, "Fallenmechanik (Ungelernt)", "0", "0");
		setFert = setFertSinnUngelernt(setFert, "Geländelauf (Ungelernt)", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Klettern (Ungelernt)", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Landeskunde (Ungelernt)", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Menschenkenntnis (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Reiten (Ungelernt)", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Schleichen (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Trinken", trinken, "0");
		setFert = setFertSinnUngelernt(setFert, "Schwimme (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Seilkunst (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Spurensuche (Ungelernt)", "0", "0");
		setFert = setFertSinnUngelernt(setFert, "Stehlen (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Tarnen (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Tauchen (Ungelernt)", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Überlebe (Ungelernt)n", "6", "0");
		setFert = setFertSinnUngelernt(setFert, "Verführen (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Verhören (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Verstellen (Ungelernt)", "3", "0");
		setFert = setFertSinnUngelernt(setFert, "Wagenlenken (Ungelernt)", "3", "0");

		// Zum Abschluss alles wegschreiben
		setAttrs(setFert)
	});
};

// SetFert für ungelernte und Sinne aufbauen

	var setFertSinnUngelernt = function (setFert, Name, FW, LeitE) {
		var newrowid = generateRowID(); //Neue RowID holen

		setFert['repeating_fertigkeiten2_' + newrowid + '_Fertigkeit2'] = Name;
		setFert['repeating_fertigkeiten2_' + newrowid + '_FW2'] = FW;
		setFert['repeating_fertigkeiten2_' + newrowid + '_LeitE2'] = LeitE;	
		
		return setFert;
	};


// Alte Repeating section auf Kampfblatt löschen. Wird ab V2 nicht mehr gebraucht		

function ClearFertigkeitKampfblattAlt() {

	// Alte Werte löschen

	getSectionIDs("repeating_fertigkeiten3", function (idarray) {
		for (var i = 0; i < idarray.length; i++) {
			removeRepeatingRow("repeating_fertigkeiten3_" + idarray[i]);
		};
	});
	};

// Alte Repeating section auf Kampfblatt löschen. Wird ab V2 nicht mehr gebraucht	
	function ClearZauberKampfblattAlt() {

		// Alte Werte löschen

		getSectionIDs("repeating_zauber2", function (idarray) {
			for (var i = 0; i < idarray.length; i++) {
				removeRepeatingRow("repeating_zauber2_" + idarray[i]);
			};
		});
	};

	// Section IDS in der Reihenfolge lesen wie sie auf dem Blatt stehen	

	var getSectionIDsOrdered = function (sectionName, callback) {
		'use strict';
		getAttrs([`_reporder_${sectionName}`], function (v) {
			getSectionIDs(sectionName, function (idArray) {
				let reporderArray = v[`_reporder_${sectionName}`] ? v[`_reporder_${sectionName}`].toLowerCase().split(',') : [],
					ids = [...new Set(reporderArray.filter(x => idArray.includes(x)).concat(idArray))];
				callback(ids);
			});
		});
	};

	var extractCurrentId = function (eventinfo) {
		var array = eventinfo.sourceAttribute.split("_");
		return array[2];
	};

	var extractEvent = function (eventinfo) {
		var array = eventinfo.sourceAttribute.split("_");
		return array[3];
	};

	// Register the click handler to all specified buttons.
	const toggleList = ["KannZaubern"];
	toggleList.forEach(function (button_toggle) {
		on(`clicked:${button_toggle}`, function () {
			const flag = `${button_toggle}`;
			// Check the current value of the hidden flag.
			getAttrs([flag], function (v) {
				// Update the value of the hidden flag to "1" for checked or "0" for unchecked.
				setAttrs({
					[flag]: v[flag] !== "1" ? "1" : "0"
				});
			});
		});
	});

// Bei Änderung der Checkbox "Zauber auf Kampfblatt" den unsichtbaren Toggle für das hidden Feld setzen oder löschen

//	on("change:repeating_zauber:ZauKB", function () {
	on("clicked:zaukb", function () {

		RecalcKampfblattZauber();
	
	});	

// Bei Änderung der Checkbox "Fertigkeit auf Kampfblatt" den unsichtbaren Toggle für das hidden Feld setzen oder löschen

//	on("change:repeating_fertigkeiten:FertKB", function () {
	on("clicked:fertkb", function () {

		RecalcKampfblattFertigkeiten();
	
	});		

// Fertigkeiten auf Kampfblätter neu berechnen	
	function RecalcKampfblattFertigkeiten() {

		getSectionIDs("repeating_fertigkeiten", function (idarray) {
			var setFert = {}; // Fertigkeitenliste auf Kampfblatt

			_.each(idarray, function (currentID, i) {
				getAttrs(['repeating_fertigkeiten_' + currentID + '_FertKB'], function (value) { 				  

					if (value['repeating_fertigkeiten_' + currentID + '_FertKB'] == true) {

						// Sichtbar auf Kampfblatt

						setFert['repeating_fertigkeiten_' + currentID + '_repeating_show'] = "1";
					} else {

						// Nict sichtbar auf Kampfblatt

						setFert['repeating_fertigkeiten_' + currentID + '_repeating_show'] = "0";
						
					};
					setAttrs(setFert); //Update
				});
			});
		});	

	};	

// Zauber auf Kampfblätter neu berechnen	
	function RecalcKampfblattZauber() {

		getSectionIDs("repeating_zauber", function (idarray) {
			var setZaub = {}; // Zauberliste auf Kampfblatt

			_.each(idarray, function (currentID, i) {
				getAttrs(['repeating_zauber_' + currentID + '_ZauKB'], function (value) { //Get oldAttribute from FieldID				  

					if (value['repeating_zauber_' + currentID + '_ZauKB'] == true) {

						// Sichtbar auf Kampfblatt

						setZaub['repeating_zauber_' + currentID + '_repeating_show'] = "1";
					} else {

						// Nict sichtbar auf Kampfblatt

						setZaub['repeating_zauber_' + currentID + '_repeating_show'] = "0";
						
					};
					setAttrs(setZaub); //Update
				});
			});
		});	

	};		
</script>